<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • mvgam</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://nicholasjclark.github.io/mvgam/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">mvgam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.594</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/data_in_mvgam.html">Formatting data for use in mvgam</a>
    <a class="dropdown-item" href="articles/forecast_evaluation.html">Forecasting and forecast evaluation in mvgam</a>
    <a class="dropdown-item" href="articles/mvgam_overview.html">Overview of the mvgam package</a>
    <a class="dropdown-item" href="articles/nmixtures.html">N-mixtures in mvgam</a>
    <a class="dropdown-item" href="articles/shared_states.html">Shared latent states in mvgam</a>
    <a class="dropdown-item" href="articles/time_varying_effects.html">Time-varying effects in mvgam</a>
    <a class="dropdown-item" href="articles/trend_formulas.html">State-Space models in mvgam</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nicholasjclark/mvgam/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/mvgam/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p>mvgam is an R package for fitting Multivariate Dynamic Generalized Additive Models.The package enables Bayesian forecasting and analysis of multivariate time series data using flexible GAM frameworks. It can handle various data types (counts, proportions, continuous values) with complex temporal dynamics, missing data, and seasonality, building custom Stan models that provide robust Bayesian inference.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<ul><li>
<code>R CMD check</code> - Full package check (used in CI)</li>
<li>
<code>testthat::test_check("mvgam")</code> - Run all tests via testthat</li>
<li>
<code>devtools::test()</code> - Run tests interactively during development</li>
</ul></div>
<div class="section level3">
<h3 id="building-and-documentation">Building and Documentation<a class="anchor" aria-label="anchor" href="#building-and-documentation"></a></h3>
<ul><li>
<code>devtools::document()</code> - Generate documentation from roxygen2 comments</li>
<li>
<code><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a></code> - Build package website</li>
<li>
<code>devtools::build()</code> - Build package tarball</li>
<li>
<code>devtools::install()</code> - Install package locally for development</li>
</ul></div>
<div class="section level3">
<h3 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a></h3>
<ul><li>Uses standard R package structure with DESCRIPTION, NAMESPACE, and man/ directories</li>
<li>Source code organized in <code>R/</code> directory with provider-specific files</li>
<li>Vignettes in vignettes/ directory demonstrate key features</li>
<li>Tests in <code>tests/testthat/</code>
</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="key-design-patterns">Key Design Patterns<a class="anchor" aria-label="anchor" href="#key-design-patterns"></a></h3>
<p><strong>S3 Type System</strong>: Uses S3 for structured objects - Maintains compatibility with R’s statistical modeling ecosystem - Supports method inheritance and specialization</p>
<p><strong>Layered Architecture Pattern</strong>: Uses clear separation of concerns across multiple layers: - Interface Layer: User-facing functions (mvgam(), forecast(), plot()) provide clean APIs - Model Specification Layer: Formula processing, trend model constructors (RW(), VAR(), GP()), family definitions - Code Generation Layer: Translates R specifications into Stan/JAGS model code - Computational Backend Layer: Interfaces with Stan/JAGS for MCMC sampling - Post-processing Layer: Methods for analysis, diagnostics, and visualization</p>
<p><strong>Modular Component System</strong>: Modular design where different components can be mixed and matched: - Trend Modules: Independent implementations of different temporal dynamics (Random Walk, AR, VAR, Gaussian Process, CAR) - Family Modules: Separate observation model implementations for different distributions - Backend Modules: Pluggable computational backends (Stan via rstan/cmdstanr, JAGS) - Visualization Modules: Modular plotting system with specialized functions for different aspects</p>
<p><strong>Bayesian Workflow Integration Pattern</strong>: Designed around the complete Bayesian modeling workflow: - Model Building: Formula specification, prior setup, trend model selection - Fitting: MCMC sampling with convergence monitoring - Checking: Posterior predictive checks, residual analysis, diagnostic plots - Inference: Parameter summarization, uncertainty quantification - Prediction: Forecasting with proper uncertainty propagation - Evaluation: Cross-validation, scoring rules, model comparison</p>
</div>
</div>
<div class="section level2">
<h2 id="key-files">Key Files<a class="anchor" aria-label="anchor" href="#key-files"></a></h2>
<div class="section level3">
<h3 id="core-model-functions">Core Model Functions<a class="anchor" aria-label="anchor" href="#core-model-functions"></a></h3>
<ul><li>
<code>R/mvgam.R</code> - Main model fitting function that:
<ul><li>Validates and processes GAM formulas for observation and trend processes</li>
<li>Sets up Stan/JAGS model code generation</li>
<li>Runs MCMC sampling and returns fitted model objects</li>
</ul></li>
<li>Trend model constructors in <code>R/mvgam_trend_types.R</code> (<code><a href="reference/RW.html">RW()</a></code>, <code><a href="reference/RW.html">AR()</a></code>, <code><a href="reference/RW.html">VAR()</a></code>, <code><a href="reference/GP.html">GP()</a></code>, <code><a href="reference/RW.html">CAR()</a></code>):
<ul><li>Define temporal dynamics specifications</li>
<li>Configure stationarity constraints and correlation structures</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="prediction--forecasting">Prediction &amp; Forecasting<a class="anchor" aria-label="anchor" href="#prediction--forecasting"></a></h3>
<ul><li>
<code>R/forecast.mvgam.R</code> - Generates in-sample and out-of-sample forecasts:
<ul><li>Respects temporal dynamics for proper time series forecasting</li>
<li>Supports multiple prediction types (response, trend, link)</li>
<li>Returns structured forecast objects with uncertainty quantification</li>
</ul></li>
<li>
<code>R/predict.mvgam.R</code> - General prediction treating trends as random effects</li>
</ul></div>
<div class="section level3">
<h3 id="visualization-suite">Visualization Suite<a class="anchor" aria-label="anchor" href="#visualization-suite"></a></h3>
<ul><li>
<code>R/plot.mvgam.R</code> - Main plotting method with multiple types:
<ul><li>Series plots, residual diagnostics, smooth functions, forecasts</li>
<li>Calls specialized functions: <code><a href="reference/plot_mvgam_forecasts.html">plot_mvgam_forecasts()</a></code>, <code><a href="reference/plot_mvgam_series.html">plot_mvgam_series()</a></code>, <code><a href="reference/plot_mvgam_trend.html">plot_mvgam_trend()</a></code>
</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="model-analysis">Model Analysis<a class="anchor" aria-label="anchor" href="#model-analysis"></a></h3>
<ul><li>
<code>R/summary.mvgam.R</code> - Parameter estimates and convergence diagnostics</li>
<li>
<code>R/ppc.mvgam.R</code> - Posterior predictive checks using bayesplot</li>
<li>
<code>R/residuals.mvgam.R</code> - Dunn-Smyth residuals for model checking</li>
<li>
<code>R/loo.mvgam.R</code> - Approximate leave-one-out cross-validation</li>
</ul></div>
<div class="section level3">
<h3 id="family-support">Family Support<a class="anchor" aria-label="anchor" href="#family-support"></a></h3>
<ul><li>Extensive distribution families in <code>R/families.R</code>:
<ul><li>Standard: gaussian, poisson, binomial, Gamma</li>
<li>Extended: negative binomial, beta, Student-t, Tweedie</li>
<li>Special: N-mixture models for imperfect detection</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="testing-and-quality">Testing and Quality<a class="anchor" aria-label="anchor" href="#testing-and-quality"></a></h3>
<ul><li>
<code>tests/testthat/</code> - Test suite</li>
<li>
<code>vignettes/</code> - Documentation and examples</li>
<li>
<code>.github/workflows/</code> - CI/CD with R CMD check, pkgdown building and valgrind check</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="development-notes">Development Notes<a class="anchor" aria-label="anchor" href="#development-notes"></a></h2>
<div class="section level3">
<h3 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h3>
<ul><li>Separate test files for each major component</li>
<li>Prioritize internal mvgam objects (i.e. <code>mvgam:::mvgam_example1</code>) for testing</li>
</ul></div>
<div class="section level3">
<h3 id="file-management">File Management<a class="anchor" aria-label="anchor" href="#file-management"></a></h3>
<ul><li>Specification documents (<code>*-requirements.md</code>, <code>*-design.md</code>, <code>*-implementation.md</code>) should be automatically added to <code>.Rbuildignore</code>
</li>
<li>Any temporary development files should be excluded from package builds</li>
<li>When creating new specification files, always update <code>.Rbuildignore</code> to prevent inclusion in built package</li>
</ul></div>
<div class="section level3">
<h3 id="code-organization">Code Organization<a class="anchor" aria-label="anchor" href="#code-organization"></a></h3>
<ul><li>Provider files should follow consistent naming pattern</li>
<li>Utility functions should be grouped by purpose (<code>utils-*.R</code>)</li>
<li>Standalone imports should minimize external dependencies</li>
</ul></div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<ul><li>Roxygen2 comments for all exported functions</li>
<li>tidyverse styling (<a href="https://style.tidyverse.org/" class="external-link uri">https://style.tidyverse.org/</a>) for all R and roxygen code</li>
<li>Vignettes demonstrate in-depth use cases</li>
<li>pkgdown site provides comprehensive documentation</li>
<li>Examples demonstrate simpler use cases</li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://researchers.uq.edu.au/researcher/15140" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

