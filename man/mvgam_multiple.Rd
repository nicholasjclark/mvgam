% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mvgam_core.R
\name{mvgam_multiple}
\alias{mvgam_multiple}
\title{Fit mvgam Models to Multiple Imputation Datasets}
\usage{
mvgam_multiple(
  formula,
  trend_formula = NULL,
  data_list,
  backend = getOption("brms.backend", "cmdstanr"),
  combine = TRUE,
  check_data = TRUE,
  ...
)
}
\arguments{
\item{formula}{Model formula (observation model). Supports brms
formula syntax including smooths and random effects.}

\item{trend_formula}{Optional trend formula specifying
state-space dynamics. Can be response-specific in multivariate
models.}

\item{data_list}{List of imputed data frames. Each element must
have identical structure (same variables, same ordering).
Alternatively, a \code{mids} object from the mice package.}

\item{backend}{Character string specifying Stan backend:
"cmdstanr" or "rstan". Defaults to
\code{getOption("brms.backend", "cmdstanr")}.}

\item{combine}{Logical; if \code{TRUE} (default), combines posteriors
into a pooled mvgam_pooled object. If \code{FALSE}, returns list of
individual fits.}

\item{check_data}{Logical; if \code{TRUE} (default), validates
consistency across imputations (same column names, types,
rows).}

\item{...}{Additional arguments passed to \code{mvgam()} for each
imputation (e.g., chains, iter, family, priors).}
}
\value{
If \code{combine=TRUE}: An object of class
\code{c("mvgam_pooled", "mvgam", "brmsfit")} containing:
\itemize{
\item{Pooled posterior draws from all imputations}
\item{Attribute \code{individual_fits}: List of per-imputation
mvgam objects}
\item{Attribute \code{n_imputations}: Number of imputations}
\item{Attribute \code{combination_method}: "sflist2stanfit"}
}

If \code{combine=FALSE}: A list of mvgam objects, one per imputation.
}
\description{
Fits Bayesian state-space models to multiply imputed datasets,
combining posteriors across imputations for proper uncertainty
quantification when dealing with missing data.
}
\details{
This function processes multiple imputed datasets in two modes:

\strong{Combined Mode (combine=TRUE)}:
Fits separate models to each imputed dataset, then combines
posteriors using \code{rstan::sflist2stanfit()} to create a pooled
posterior distribution. Returns an object of class
\code{c("mvgam_pooled", "mvgam", "brmsfit")} with MI-specific
attributes and methods.

\strong{List Mode (combine=FALSE)}:
Returns a list of individual mvgam fits, one per imputation,
allowing manual posterior combination or separate analysis.

\strong{Posterior Combination Approach}:
Uses \code{rstan::sflist2stanfit()} (validated brms pattern) to
concatenate draws from all imputations at the Stan level,
properly accounting for between-imputation and
within-imputation variance. This approach ensures valid
uncertainty quantification following proper multiple imputation
principles.

\strong{MI Diagnostics}:
Pooled objects include convergence diagnostics per imputation
(Rhat, ESS) accessible via \code{summary()}. The print method
displays comprehensive MI diagnostics including total draws,
draws per imputation, and convergence summaries.
}
\examples{
\dontrun{
# Create pseudo-imputed data (3 imputations)
base_data <- data.frame(
  time = 1:24,
  series = factor(rep("series1", 24)),
  y = rnorm(24, mean = 3, sd = 1),
  season = 1:24
)

imputed_list <- lapply(1:3, function(i) {
  data_copy <- base_data
  data_copy$y <- data_copy$y + rnorm(nrow(data_copy), 0, 0.1)
  data_copy
})

# Fit with combined posteriors (recommended)
fit_pooled <- mvgam_multiple(
  formula = y ~ s(season, bs = "cc", k = 5),
  trend_formula = ~ 1,
  data_list = imputed_list,
  family = gaussian(),
  combine = TRUE
)

# Check MI diagnostics
summary(fit_pooled)
print(fit_pooled)

# Fit separately (for advanced use cases)
fit_list <- mvgam_multiple(
  formula = y ~ s(season, bs = "cc", k = 5),
  trend_formula = ~ 1,
  data_list = imputed_list,
  family = gaussian(),
  combine = FALSE
)
}

}
\seealso{
\code{\link{summary.mvgam_pooled}},
\code{\link{print.mvgam_pooled_summary}}, \code{\link{mvgam}}
}
