<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Set up piecewise linear or logistic trend models
in mvgam. These functions do not evaluate their arguments –
they exist purely to help set up a model with particular piecewise
trend models."><title>Specify piecewise linear or logistic trends in mvgam models — PW • mvgam</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Specify piecewise linear or logistic trends in mvgam models — PW"><meta property="og:description" content="Set up piecewise linear or logistic trend models
in mvgam. These functions do not evaluate their arguments –
they exist purely to help set up a model with particular piecewise
trend models."><meta property="og:image" content="https://nicholasjclark.github.io/mvgam/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mvgam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.54</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_in_mvgam.html">Formatting data for use in mvgam</a>
    <a class="dropdown-item" href="../articles/forecast_evaluation.html">Forecasting and forecast evaluation in mvgam</a>
    <a class="dropdown-item" href="../articles/mvgam_overview.html">Overview of the mvgam package</a>
    <a class="dropdown-item" href="../articles/nmixtures.html">N-mixtures in mvgam</a>
    <a class="dropdown-item" href="../articles/shared_states.html">Shared latent states in mvgam</a>
    <a class="dropdown-item" href="../articles/time_varying_effects.html">Time-varying effects in mvgam</a>
    <a class="dropdown-item" href="../articles/trend_formulas.html">State-Space models in mvgam</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nicholasjclark/mvgam/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Specify piecewise linear or logistic trends in <span class="pkg">mvgam</span> models</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/mvgam/blob/HEAD/R/mvgam_trend_types.R" class="external-link"><code>R/mvgam_trend_types.R</code></a></small>
      <div class="d-none name"><code>piecewise_trends.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Set up piecewise linear or logistic trend models
in <code>mvgam</code>. These functions do not evaluate their arguments –
they exist purely to help set up a model with particular piecewise
trend models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">PW</span><span class="op">(</span></span>
<span>  n_changepoints <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  changepoint_range <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  changepoint_scale <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  growth <span class="op">=</span> <span class="st">"linear"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>n_changepoints</dt>
<dd><p>A non-negative integer specifying the number of potential
changepoints. Potential changepoints are selected uniformly from the
first <code>changepoint_range</code> proportion of timepoints in <code>data</code>. Default is <code>10</code></p></dd>


<dt>changepoint_range</dt>
<dd><p>Proportion of history in <code>data</code> in which trend changepoints
will be estimated. Defaults to 0.8 for the first 80%.</p></dd>


<dt>changepoint_scale</dt>
<dd><p>Parameter modulating the flexibility of the
automatic changepoint selection by altering the scale parameter of a Laplace distribution.
The resulting prior will be <code>double_exponential(0, changepoint_scale)</code>.
Large values will allow many changepoints and a more flexible trend, while
small values will allow few changepoints. Default is <code>0.05</code>.</p></dd>


<dt>growth</dt>
<dd><p>Character string specifying either 'linear' or 'logistic' growth of
the trend. If 'logistic', a variable labelled <code>cap</code> MUST be in <code>data</code> to specify the
maximum saturation point for the trend (see details and examples in <code><a href="mvgam.html">mvgam</a></code> for
more information).
Default is 'linear'.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>mvgam_trend</code>, which contains a list of
arguments to be interpreted by the parsing functions in <code>mvgam</code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><em>Offsets and intercepts</em>:
For each of these trend models, an offset parameter is included in the trend
estimation process. This parameter will be incredibly difficult to identify
if you also include an intercept in the observation formula. For that reason,
it is highly recommended that you drop the intercept from the formula
(i.e. <code>y ~ x + 0</code> or <code>y ~ x - 1</code>, where <code>x</code> are your optional predictor terms).
<br><br><em>Logistic growth and the cap variable</em>:
When forecasting growth, there is often some maximum achievable point that
a time series can reach. For example, total market size, total population size
or carrying capacity in population dynamics. It can be advantageous for the forecast
to saturate at or near this point so that predictions are more sensible.
This function allows you to make forecasts using a logistic growth trend model,
with a specified carrying capacity. Note that this capacity does not need to be static
over time, it can vary with each series x timepoint combination if necessary. But you
must supply a <code>cap</code> value for each observation in the data when using <code>growth = 'logistic'</code>.
For observation families that use a non-identity link function, the <code>cap</code> value will
be internally transformed to the link scale (i.e. your specified <code>cap</code> will be log
transformed if you are using a <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> or <code><a href="mvgam_families.html">nb()</a></code> family). It is therefore important
that you specify the <code>cap</code> values on the scale of your outcome. Note also that
no missing values are allowed in <code>cap</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Taylor, Sean J., and Benjamin Letham. "Forecasting at scale." The American Statistician 72.1 (2018): 37-45.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nicholas J Clark</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Example of logistic growth with possible changepoints</span></span></span>
<span class="r-in"><span><span class="co"># Simple logistic growth model</span></span></span>
<span class="r-in"><span><span class="va">dNt</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span>, <span class="va">N</span>, <span class="va">k</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">r</span> <span class="op">*</span> <span class="va">N</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">-</span> <span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Iterate growth through time</span></span></span>
<span class="r-in"><span><span class="va">Nt</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span>, <span class="va">N</span>, <span class="va">t</span>, <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># population at next time step is current population + growth,</span></span></span>
<span class="r-in"><span> <span class="co"># but we introduce several 'shocks' as changepoints</span></span></span>
<span class="r-in"><span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">15</span>, <span class="fl">25</span>, <span class="fl">41</span>, <span class="fl">45</span>, <span class="fl">60</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">N</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu">dNt</span><span class="op">(</span><span class="va">r</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 <span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">N</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu">dNt</span><span class="op">(</span><span class="va">r</span>, <span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span> <span class="va">N</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate expected values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">expected</span> <span class="op">&lt;-</span> <span class="fu">Nt</span><span class="op">(</span><span class="fl">0.004</span>, <span class="fl">2</span>, <span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">expected</span>, xlab <span class="op">=</span> <span class="st">'Time'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="piecewise_trends-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Take Poisson draws</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">expected</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span>, xlab <span class="op">=</span> <span class="st">'Time'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="piecewise_trends-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assemble data into dataframe and model. We set a</span></span></span>
<span class="r-in"><span><span class="co"># fixed carrying capacity of 35 for this example, but note that</span></span></span>
<span class="r-in"><span><span class="co"># this value is not required to be fixed at each timepoint</span></span></span>
<span class="r-in"><span><span class="va">mod_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>                       time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       cap <span class="op">=</span> <span class="fl">35</span>,</span></span>
<span class="r-in"><span>                       series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="st">'series_1'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mod_data</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="piecewise_trends-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The intercept is nonidentifiable when using piecewise</span></span></span>
<span class="r-in"><span><span class="co"># trends because the trend functions have their own offset</span></span></span>
<span class="r-in"><span><span class="co"># parameters 'm'; it is recommended to always drop intercepts</span></span></span>
<span class="r-in"><span><span class="co"># when using these trend models</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>             trend_model <span class="op">=</span> <span class="fu">PW</span><span class="op">(</span>growth <span class="op">=</span> <span class="st">'logistic'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="va">mod_data</span>,</span></span>
<span class="r-in"><span>             chains <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>             silent <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GAM formula:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5602d43800c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poisson</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trend model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PW(growth = "logistic")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N series:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N timepoints:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Status:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitted using Stan </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 chains, each with iter = 1000; warmup = 500; thin = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total post-warmup draws = 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GAM coefficient (beta) estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             2.5% 50% 97.5% Rhat n_eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    0   0     0  NaN   NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Latent trend growth rate estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             2.5%   50% 97.5% Rhat n_eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> k_trend[1] -0.26 -0.15 -0.07    1   391</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Latent trend offset estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            2.5%  50% 97.5% Rhat n_eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_trend[1]  -18 -4.2 -0.38    1   235</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Stan MCMC diagnostics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ✔ No issues with effective samples per iteration</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ✔ Rhat looks good for all parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ✔ No issues with divergences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ✖ 102 of 1000 iterations saturated the maximum tree depth of 10 (10.2%)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Try a larger max_treedepth to avoid saturation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Samples were drawn using sampling(hmc). For each parameter, n_eff is a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   crude measure of effective sample size, and Rhat is the potential scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   reduction factor on split MCMC chains (at convergence, Rhat = 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use how_to_cite() to get started describing this model</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the posterior hindcast</span></span></span>
<span class="r-in"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="hindcast.mvgam.html">hindcast</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hc</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No non-missing values in test_observations; cannot calculate forecast score</span>
<span class="r-plt img"><img src="piecewise_trends-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the changepoints with ggplot2 utilities</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/mcmc_plot.brmsfit.html" class="external-link">mcmc_plot</a></span><span class="op">(</span><span class="va">mod</span>, variable <span class="op">=</span> <span class="st">'delta_trend'</span>,</span></span>
<span class="r-in"><span>          regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">trend_model</span><span class="op">$</span><span class="va">changepoints</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Potential changepoint'</span>,</span></span>
<span class="r-in"><span>     x <span class="op">=</span> <span class="st">'Rate change'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for <span style="color: #00BB00;">y</span> is already present.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span>
<span class="r-plt img"><img src="piecewise_trends-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate a methods description scaffold</span></span></span>
<span class="r-in"><span><span class="fu"><a href="how_to_cite.mvgam.html">how_to_cite</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Methods text skeleton</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> We used the R package mvgam (version 1.1.54; Clark &amp; Wells, 2023) to</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   construct, fit and interrogate the model. mvgam fits Bayesian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   State-Space models that can include flexible predictor effects in both</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   the process and observation components by incorporating functionalities</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   from the brms (Burkner 2017), mgcv (Wood 2017) and splines2 (Wang &amp; Yan,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2023) packages. Piecewise dynamic trends were parameterized and</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   estimated following methods described by Taylor and Letham (2018). The</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   mvgam-constructed model and observed data were passed to the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   probabilistic programming environment Stan (version 2.36.0; Carpenter et</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   al. 2017, Stan Development Team 2025), specifically through the cmdstanr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   interface (Gabry &amp; Cesnovar, 2021). We ran 2 Hamiltonian Monte Carlo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   chains for 500 warmup iterations and 500 sampling iterations for joint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   posterior estimation. Rank normalized split Rhat (Vehtari et al. 2021)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   and effective sample sizes were used to monitor convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Primary references</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Clark, NJ and Wells K (2023). Dynamic Generalized Additive Models</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (DGAMs) for forecasting discrete ecological time series. Methods in</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Ecology and Evolution, 14, 771-784. doi.org/10.1111/2041-210X.13974</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burkner, PC (2017). brms: An R Package for Bayesian Multilevel Models</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Using Stan. Journal of Statistical Software, 80(1), 1-28.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   doi:10.18637/jss.v080.i01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wood, SN (2017). Generalized Additive Models: An Introduction with R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (2nd edition). Chapman and Hall/CRC.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wang W and Yan J (2021). Shape-Restricted Regression Splines with R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Package splines2. Journal of Data Science, 19(3), 498-517.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   doi:10.6339/21-JDS1020 https://doi.org/10.6339/21-JDS1020.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Taylor S and Letham B (2018). Forecasting at scale. The American</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Statistician 72(1) 37-45. https://doi.org/10.1080/00031305.2017.1380080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Carpenter B, Gelman A, Hoffman MD, Lee D, Goodrich B, Betancourt M,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Brubaker M, Guo J, Li P and Riddell A (2017). Stan: A probabilistic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   programming language. Journal of Statistical Software 76.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gabry J, Cesnovar R, Johnson A, and Bronder S (2025). cmdstanr: R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Interface to 'CmdStan'. https://mc-stan.org/cmdstanr/,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   https://discourse.mc-stan.org.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vehtari A, Gelman A, Simpson D, Carpenter B, and Burkner P (2021).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Rank-normalization, folding, and localization: An improved Rhat for</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   assessing convergence of MCMC (with discussion). Bayesian Analysis 16(2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   667-718. https://doi.org/10.1214/20-BA1221.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Other useful references</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Arel-Bundock V, Greifer N, and Heiss A (2024). How to interpret</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   statistical models using marginaleffects for R and Python. Journal of</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Statistical Software, 111(9), 1-32.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   https://doi.org/10.18637/jss.v111.i09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gabry J, Simpson D, Vehtari A, Betancourt M, and Gelman A (2019).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Visualization in Bayesian workflow. Journal of the Royal Statatistical</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Society A, 182, 389-402. doi:10.1111/rssa.12378.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vehtari A, Gelman A, and Gabry J (2017). Practical Bayesian model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   evaluation using leave-one-out cross-validation and WAIC. Statistics and</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Computing, 27, 1413-1432. doi:10.1007/s11222-016-9696-4.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burkner PC, Gabry J, and Vehtari A. (2020). Approximate leave-future-out</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cross-validation for Bayesian time series models. Journal of Statistical</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Computation and Simulation, 90(14), 2499-2523.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   https://doi.org/10.1080/00949655.2020.1783262</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://researchers.uq.edu.au/researcher/15140" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

