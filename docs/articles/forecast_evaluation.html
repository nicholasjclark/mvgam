<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mvgam">
<title>Forecasting and forecast evaluation in mvgam • mvgam</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Forecasting and forecast evaluation in mvgam">
<meta property="og:description" content="mvgam">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mvgam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.91</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_in_mvgam.html">Formatting data for use in mvgam</a>
    <a class="dropdown-item" href="../articles/forecast_evaluation.html">Forecasting and forecast evaluation in mvgam</a>
    <a class="dropdown-item" href="../articles/mvgam_overview.html">Overview of the mvgam package</a>
    <a class="dropdown-item" href="../articles/nmixtures.html">N-mixtures in mvgam</a>
    <a class="dropdown-item" href="../articles/shared_states.html">Shared latent states in mvgam</a>
    <a class="dropdown-item" href="../articles/time_varying_effects.html">Time-varying effects in mvgam</a>
    <a class="dropdown-item" href="../articles/trend_formulas.html">State-Space models in mvgam</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nicholasjclark/mvgam/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Forecasting and forecast evaluation in mvgam</h1>
                        <h4 data-toc-skip class="author">Nicholas J
Clark</h4>
            
            <h4 data-toc-skip class="date">2024-03-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/mvgam/blob/HEAD/vignettes/forecast_evaluation.Rmd" class="external-link"><code>vignettes/forecast_evaluation.Rmd</code></a></small>
      <div class="d-none name"><code>forecast_evaluation.Rmd</code></div>
    </div>

    
    
<p>The purpose of this vignette is to show how the <code>mvgam</code>
package can be used to produce probabilistic forecasts and to evaluate
those forecasts using a variety of proper scoring rules.</p>
<div class="section level2">
<h2 id="simulating-discrete-time-series">Simulating discrete time series<a class="anchor" aria-label="anchor" href="#simulating-discrete-time-series"></a>
</h2>
<p>We begin by simulating some data to show how forecasts are computed
and evaluated in <code>mvgam</code>. The <code><a href="../reference/sim_mvgam.html">sim_mvgam()</a></code>
function can be used to simulate series that come from a variety of
response distributions as well as seasonal patterns and/or dynamic
temporal patterns. Here we simulate a collection of three time
count-valued series. These series all share the same seasonal pattern
but have different temporal dynamics. By setting
<code>trend_model = 'GP'</code> and <code>prop_trend = 0.75</code>, we
are generating time series that have smooth underlying temporal trends
(evolving as Gaussian Processes with squared exponential kernel) and
moderate seasonal patterns. The observations are Poisson-distributed and
we allow 10% of observations to be missing.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2345</span><span class="op">)</span></span>
<span><span class="va">simdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_mvgam.html">sim_mvgam</a></span><span class="op">(</span>T <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                    n_series <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                    trend_model <span class="op">=</span> <span class="st">'GP'</span>,</span>
<span>                    prop_trend <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    prop_missing <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span></code></pre></div>
<p>The returned object is a <code>list</code> containing training and
testing data (<code><a href="../reference/sim_mvgam.html">sim_mvgam()</a></code> automatically splits the data
into these folds for us) together with some other information about the
data generating process that was used to simulate the data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">simdat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 6</span></span>
<span><span class="co">##  $ data_train        :'data.frame':  225 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ y     : int [1:225] 0 1 3 0 0 0 1 0 3 1 ...</span></span>
<span><span class="co">##   ..$ season: int [1:225] 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">##   ..$ year  : int [1:225] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..$ series: Factor w/ 3 levels "series_1","series_2",..: 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co">##   ..$ time  : int [1:225] 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">##  $ data_test         :'data.frame':  75 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ y     : int [1:75] 0 1 1 0 0 0 2 2 0 NA ...</span></span>
<span><span class="co">##   ..$ season: int [1:75] 4 4 4 5 5 5 6 6 6 7 ...</span></span>
<span><span class="co">##   ..$ year  : int [1:75] 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">##   ..$ series: Factor w/ 3 levels "series_1","series_2",..: 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co">##   ..$ time  : int [1:75] 76 76 76 77 77 77 78 78 78 79 ...</span></span>
<span><span class="co">##  $ true_corrs        : num [1:3, 1:3] 1 0.465 -0.577 0.465 1 ...</span></span>
<span><span class="co">##  $ true_trends       : num [1:100, 1:3] -1.45 -1.54 -1.61 -1.67 -1.73 ...</span></span>
<span><span class="co">##  $ global_seasonality: num [1:100] 0.0559 0.6249 1.3746 1.6805 0.5246 ...</span></span>
<span><span class="co">##  $ trend_params      :List of 2</span></span>
<span><span class="co">##   ..$ alpha: num [1:3] 0.767 0.988 0.897</span></span>
<span><span class="co">##   ..$ rho  : num [1:3] 6.02 6.94 5.04</span></span></code></pre>
<p>Each series in this case has a shared seasonal pattern, which we can
visualise:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simdat</span><span class="op">$</span><span class="va">global_seasonality</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, </span>
<span>     type <span class="op">=</span> <span class="st">'l'</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">'Relative effect'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Season'</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-3-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The resulting time series are similar to what we might encounter when
dealing with count-valued data that can take small counts:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>, </span>
<span>                  series <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-4-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>For each individual series, we can plot the training and testing
data, as well as some more specific features of the observed data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>, </span>
<span>                  newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>,</span>
<span>                  series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-5-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>, </span>
<span>                  newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>,</span>
<span>                  series <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-5-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>, </span>
<span>                  newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>,</span>
<span>                  series <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-5-3.png" width="60%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="modelling-dynamics-with-splines">Modelling dynamics with splines<a class="anchor" aria-label="anchor" href="#modelling-dynamics-with-splines"></a>
</h3>
<p>The first model we will fit uses a shared cyclic spline to capture
the repeated seasonality, as well as series-specific splines of time to
capture the long-term dynamics. We allow the temporal splines to be
fairly complex so they can capture as much of the temporal variation as
possible:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">'cc'</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">time</span>, by <span class="op">=</span> <span class="va">series</span>, bs <span class="op">=</span> <span class="st">'cr'</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>              knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              trend_model <span class="op">=</span> <span class="st">'None'</span>,</span>
<span>              data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span><span class="op">)</span></span></code></pre></div>
<p>The model fits without issue:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span>, include_betas <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## GAM formula:</span></span>
<span><span class="co">## y ~ s(season, bs = "cc", k = 8) + s(time, by = series, bs = "cr", </span></span>
<span><span class="co">##     k = 20)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family:</span></span>
<span><span class="co">## poisson</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Link function:</span></span>
<span><span class="co">## log</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Trend model:</span></span>
<span><span class="co">## None</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## N series:</span></span>
<span><span class="co">## 3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## N timepoints:</span></span>
<span><span class="co">## 75 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Status:</span></span>
<span><span class="co">## Fitted using Stan </span></span>
<span><span class="co">## 4 chains, each with iter = 1000; warmup = 500; thin = 1 </span></span>
<span><span class="co">## Total post-warmup draws = 2000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## GAM coefficient (beta) estimates:</span></span>
<span><span class="co">##              2.5%   50%  97.5% Rhat n_eff</span></span>
<span><span class="co">## (Intercept) -0.41 -0.21 -0.039    1   813</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of GAM observation smooths:</span></span>
<span><span class="co">##                         edf Chi.sq p-value    </span></span>
<span><span class="co">## s(season)              3.77   9.48 0.01603 *  </span></span>
<span><span class="co">## s(time):seriesseries_1 6.50  13.64 0.09218 .  </span></span>
<span><span class="co">## s(time):seriesseries_2 9.49 256.09 0.00021 ***</span></span>
<span><span class="co">## s(time):seriesseries_3 5.93  16.79 0.04680 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stan MCMC diagnostics:</span></span>
<span><span class="co">## n_eff / iter looks reasonable for all parameters</span></span>
<span><span class="co">## Rhat looks reasonable for all parameters</span></span>
<span><span class="co">## 0 of 2000 iterations ended with a divergence (0%)</span></span>
<span><span class="co">## 0 of 2000 iterations saturated the maximum tree depth of 12 (0%)</span></span>
<span><span class="co">## E-FMI indicated no pathological behavior</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Samples were drawn using NUTS(diag_e) at Tue Mar 12 1:56:47 PM 2024.</span></span>
<span><span class="co">## For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">## and Rhat is the potential scale reduction factor on split MCMC chains</span></span>
<span><span class="co">## (at convergence, Rhat = 1)</span></span></code></pre>
<p>And we can plot the partial effects of the splines to see that they
are estimated to be highly nonlinear</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod1</span>, type <span class="op">=</span> <span class="st">'smooths'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-9-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="modelling-dynamics-with-gps">Modelling dynamics with GPs<a class="anchor" aria-label="anchor" href="#modelling-dynamics-with-gps"></a>
</h3>
<p>Before showing how to produce and evaluate forecasts, we will fit a
second model to these data so the two models can be compared. This model
is equivalent to the above, except we now use Gaussian Processes to
model series-specific dynamics. This makes use of the <code><a href="https://paul-buerkner.github.io/brms/reference/gp.html" class="external-link">gp()</a></code>
function from <code>brms</code>, which can fit Hilbert space approximate
GPs. See <code><a href="https://paul-buerkner.github.io/brms/reference/gp.html" class="external-link">?brms::gp</a></code> for more details.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">'cc'</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gp.html" class="external-link">gp</a></span><span class="op">(</span><span class="va">time</span>, by <span class="op">=</span> <span class="va">series</span>, c <span class="op">=</span> <span class="fl">5</span><span class="op">/</span><span class="fl">4</span>, k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                   scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>              knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              trend_model <span class="op">=</span> <span class="st">'None'</span>,</span>
<span>              data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span><span class="op">)</span></span></code></pre></div>
<p>The summary for this model now contains information on the GP
parameters for each time series:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span>, include_betas <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## GAM formula:</span></span>
<span><span class="co">## y ~ s(season, bs = "cc", k = 8) + gp(time, by = series, c = 5/4, </span></span>
<span><span class="co">##     k = 20, scale = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family:</span></span>
<span><span class="co">## poisson</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Link function:</span></span>
<span><span class="co">## log</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Trend model:</span></span>
<span><span class="co">## None</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## N series:</span></span>
<span><span class="co">## 3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## N timepoints:</span></span>
<span><span class="co">## 75 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Status:</span></span>
<span><span class="co">## Fitted using Stan </span></span>
<span><span class="co">## 4 chains, each with iter = 1000; warmup = 500; thin = 1 </span></span>
<span><span class="co">## Total post-warmup draws = 2000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## GAM coefficient (beta) estimates:</span></span>
<span><span class="co">##             2.5%   50% 97.5% Rhat n_eff</span></span>
<span><span class="co">## (Intercept) -1.1 -0.52  0.31    1   768</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## GAM gp term marginal deviation (alpha) and length scale (rho) estimates:</span></span>
<span><span class="co">##                               2.5%  50% 97.5% Rhat n_eff</span></span>
<span><span class="co">## alpha_gp(time):seriesseries_1 0.21  0.8   2.1 1.01   763</span></span>
<span><span class="co">## alpha_gp(time):seriesseries_2 0.74  1.4   2.9 1.00  1028</span></span>
<span><span class="co">## alpha_gp(time):seriesseries_3 0.50  1.1   2.8 1.00  1026</span></span>
<span><span class="co">## rho_gp(time):seriesseries_1   1.20  5.1  23.0 1.00   681</span></span>
<span><span class="co">## rho_gp(time):seriesseries_2   2.20 10.0  17.0 1.00   644</span></span>
<span><span class="co">## rho_gp(time):seriesseries_3   1.50  8.8  23.0 1.00   819</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of GAM observation smooths:</span></span>
<span><span class="co">##           edf Chi.sq p-value    </span></span>
<span><span class="co">## s(season)   6     25 0.00016 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stan MCMC diagnostics:</span></span>
<span><span class="co">## n_eff / iter looks reasonable for all parameters</span></span>
<span><span class="co">## Rhat looks reasonable for all parameters</span></span>
<span><span class="co">## 4 of 2000 iterations ended with a divergence (0.2%)</span></span>
<span><span class="co">##  *Try running with larger adapt_delta to remove the divergences</span></span>
<span><span class="co">## 0 of 2000 iterations saturated the maximum tree depth of 12 (0%)</span></span>
<span><span class="co">## E-FMI indicated no pathological behavior</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Samples were drawn using NUTS(diag_e) at Tue Mar 12 1:57:51 PM 2024.</span></span>
<span><span class="co">## For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">## and Rhat is the potential scale reduction factor on split MCMC chains</span></span>
<span><span class="co">## (at convergence, Rhat = 1)</span></span></code></pre>
<p>We can plot the posteriors for these parameters, and for any other
parameter for that matter, using <code>bayesplot</code> routines. First
the marginal deviation (<span class="math inline">\(\alpha\)</span>)
parameters:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/mcmc_plot.brmsfit.html" class="external-link">mcmc_plot</a></span><span class="op">(</span><span class="va">mod2</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'alpha_gp'</span><span class="op">)</span>, regex <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">'areas'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-13-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>And now the length scale (<span class="math inline">\(\rho\)</span>)
parameters:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/mcmc_plot.brmsfit.html" class="external-link">mcmc_plot</a></span><span class="op">(</span><span class="va">mod2</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'rho_gp'</span><span class="op">)</span>, regex <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">'areas'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-14-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>We can also plot the nonlinear effects as before:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod2</span>, type <span class="op">=</span> <span class="st">'smooths'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-15-1.png" width="60%" style="display: block; margin: auto;">
These can also be plotted using <code>marginaleffects</code>
utilities:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">'ggplot2'</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/marginaleffects/man/plot_predictions.html" class="external-link">plot_predictions</a></span><span class="op">(</span><span class="va">mod2</span>, </span>
<span>                 condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'time'</span>, <span class="st">'series'</span>, <span class="st">'series'</span><span class="op">)</span>,</span>
<span>                 type <span class="op">=</span> <span class="st">'link'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-16-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The estimates for the temporal trends are fairly similar for the two
models, but below we will see if they produce similar forecasts</p>
</div>
</div>
<div class="section level2">
<h2 id="forecasting-with-the-forecast-function">Forecasting with the <code>forecast()</code> function<a class="anchor" aria-label="anchor" href="#forecasting-with-the-forecast-function"></a>
</h2>
<p>Probabilistic forecasts can be computed in two main ways in
<code>mvgam</code>. The first is to take a model that was fit only to
training data (as we did above in the two example models) and produce
temporal predictions from the posterior predictive distribution by
feeding <code>newdata</code> to the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function. It
is crucial that any <code>newdata</code> fed to the
<code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function follows on sequentially from the data
that was used to fit the model (this is not internally checked by the
package because it might be a headache to do so when data are not
supplied in a specific time-order). When calling the
<code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function, you have the option to generate
different kinds of predictions (i.e. predicting on the link scale,
response scale or to produce expectations; see
<code><a href="../reference/forecast.mvgam.html">?forecast.mvgam</a></code> for details). We will use the default and
produce forecasts on the response scale, which is the most common way to
evaluate forecast distributions</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod1</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span><span class="op">)</span></span>
<span><span class="va">fc_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod2</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span><span class="op">)</span></span></code></pre></div>
<p>The objects we have created are of class <code>mvgam_forecast</code>,
which contain information on hindcast distributions, forecast
distributions and true observations for each series in the data:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fc_mod1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ call              :Class 'formula'  language y ~ s(season, bs = "cc", k = 8) + s(time, by = series, bs = "cr", k = 20)</span></span>
<span><span class="co">##   .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; </span></span>
<span><span class="co">##  $ trend_call        : NULL</span></span>
<span><span class="co">##  $ family            : chr "poisson"</span></span>
<span><span class="co">##  $ family_pars       : NULL</span></span>
<span><span class="co">##  $ trend_model       : chr "None"</span></span>
<span><span class="co">##  $ drift             : logi FALSE</span></span>
<span><span class="co">##  $ use_lv            : logi FALSE</span></span>
<span><span class="co">##  $ fit_engine        : chr "stan"</span></span>
<span><span class="co">##  $ type              : chr "response"</span></span>
<span><span class="co">##  $ series_names      : Factor w/ 3 levels "series_1","series_2",..: 1 2 3</span></span>
<span><span class="co">##  $ train_observations:List of 3</span></span>
<span><span class="co">##   ..$ series_1: int [1:75] 0 0 1 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ series_2: int [1:75] 1 0 0 1 1 0 1 0 1 2 ...</span></span>
<span><span class="co">##   ..$ series_3: int [1:75] 3 0 3 NA 2 1 1 1 1 3 ...</span></span>
<span><span class="co">##  $ train_times       : int [1:75] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ test_observations :List of 3</span></span>
<span><span class="co">##   ..$ series_1: int [1:25] 0 0 2 NA 0 2 2 1 1 1 ...</span></span>
<span><span class="co">##   ..$ series_2: int [1:25] 1 0 2 1 1 3 0 1 0 NA ...</span></span>
<span><span class="co">##   ..$ series_3: int [1:25] 1 0 0 1 0 0 1 0 1 0 ...</span></span>
<span><span class="co">##  $ test_times        : int [1:25] 76 77 78 79 80 81 82 83 84 85 ...</span></span>
<span><span class="co">##  $ hindcasts         :List of 3</span></span>
<span><span class="co">##   ..$ series_1: num [1:2000, 1:75] 1 1 0 0 0 1 1 1 0 0 ...</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : NULL</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:75] "ypred[1,1]" "ypred[2,1]" "ypred[3,1]" "ypred[4,1]" ...</span></span>
<span><span class="co">##   ..$ series_2: num [1:2000, 1:75] 0 0 0 0 0 0 0 1 0 0 ...</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : NULL</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:75] "ypred[1,2]" "ypred[2,2]" "ypred[3,2]" "ypred[4,2]" ...</span></span>
<span><span class="co">##   ..$ series_3: num [1:2000, 1:75] 3 0 2 1 0 1 2 1 5 1 ...</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : NULL</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:75] "ypred[1,3]" "ypred[2,3]" "ypred[3,3]" "ypred[4,3]" ...</span></span>
<span><span class="co">##  $ forecasts         :List of 3</span></span>
<span><span class="co">##   ..$ series_1: num [1:2000, 1:25] 1 3 2 1 0 0 1 1 0 0 ...</span></span>
<span><span class="co">##   ..$ series_2: num [1:2000, 1:25] 6 0 0 0 0 2 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ series_3: num [1:2000, 1:25] 0 1 1 3 3 1 3 2 4 2 ...</span></span>
<span><span class="co">##  - attr(*, "class")= chr "mvgam_forecast"</span></span></code></pre>
<p>We can plot the forecasts for each series from each model using the
<code>S3 plot</code> method for objects of this class:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod1</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-1.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample CRPS:</span></span>
<span><span class="co">## [1] 14.62964</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-2.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample DRPS:</span></span>
<span><span class="co">## [1] 10.92516</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod1</span>, series <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-3.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample CRPS:</span></span>
<span><span class="co">## [1] 84201962708</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-4.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample DRPS:</span></span>
<span><span class="co">## [1] 14.31152</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod1</span>, series <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-5.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample CRPS:</span></span>
<span><span class="co">## [1] 32.44136</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-19-6.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample DRPS:</span></span>
<span><span class="co">## [1] 15.44332</span></span></code></pre>
<p>Clearly the two models do not produce equivalent forecasts. We will
come back to scoring these forecasts in a moment.</p>
</div>
<div class="section level2">
<h2 id="forecasting-with-newdata-in-mvgam">Forecasting with <code>newdata</code> in <code>mvgam()</code><a class="anchor" aria-label="anchor" href="#forecasting-with-newdata-in-mvgam"></a>
</h2>
<p>The second way we can produce forecasts in <code>mvgam</code> is to
feed the testing data directly to the <code><a href="../reference/mvgam.html">mvgam()</a></code> function as
<code>newdata</code>. This will include the testing data as missing
observations so that they are automatically predicted from the posterior
predictive distribution using the <code>generated quantities</code>
block in <code>Stan</code>. As an example, we can refit
<code>mod2</code> but include the testing data for automatic
forecasts:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">'cc'</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gp.html" class="external-link">gp</a></span><span class="op">(</span><span class="va">time</span>, by <span class="op">=</span> <span class="va">series</span>, c <span class="op">=</span> <span class="fl">5</span><span class="op">/</span><span class="fl">4</span>, k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                   scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>              knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              trend_model <span class="op">=</span> <span class="st">'None'</span>,</span>
<span>              data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>              newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span><span class="op">)</span></span></code></pre></div>
<p>Because the model already contains a forecast distribution, we do not
need to feed <code>newdata</code> to the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code>
function:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></code></pre></div>
<p>The forecasts will be nearly identical to those calculated
previously:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-23-1.png" width="60%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Out of sample DRPS:</span></span>
<span><span class="co">## [1] 10.85762</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="scoring-forecast-distributions">Scoring forecast distributions<a class="anchor" aria-label="anchor" href="#scoring-forecast-distributions"></a>
</h2>
<p>A primary purpose of the <code>mvgam_forecast</code> class is to
readily allow forecast evaluations for each series in the data, using a
variety of possible scoring functions. See
<code><a href="../reference/score.mvgam_forecast.html">?mvgam::score.mvgam_forecast</a></code> to view the types of scores
that are available. A useful scoring metric is the <a href="https://www.annualreviews.org/doi/10.1146/annurev-statistics-062713-085831" target="_blank" class="external-link">Continuous Rank Probability Score (CRPS)</a>. A CRPS
value is similar to what we might get if we calculated a weighted
absolute error using the full forecast distribution.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">'crps'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">crps_mod1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 4</span></span>
<span><span class="co">##  $ series_1  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ score         : num [1:25] 0.1938 0.1366 1.355 NA 0.0348 ...</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 NA 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">##  $ series_2  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ score         : num [1:25] 0.379 0.306 0.941 0.5 0.573 ...</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 1 1 1 1 1 1 NA ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">##  $ series_3  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ score         : num [1:25] 0.32 0.556 0.379 0.362 0.219 ...</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">##  $ all_series:'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ score       : num [1:25] 0.892 0.999 2.675 NA 0.827 ...</span></span>
<span><span class="co">##   ..$ eval_horizon: int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##   ..$ score_type  : chr [1:25] "sum_crps" "sum_crps" "sum_crps" "sum_crps" ...</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span></span></code></pre></div>
<pre><code><span><span class="co">##         score in_interval interval_width eval_horizon score_type</span></span>
<span><span class="co">## 1  0.19375525           1            0.9            1       crps</span></span>
<span><span class="co">## 2  0.13663925           1            0.9            2       crps</span></span>
<span><span class="co">## 3  1.35502175           1            0.9            3       crps</span></span>
<span><span class="co">## 4          NA          NA            0.9            4       crps</span></span>
<span><span class="co">## 5  0.03482775           1            0.9            5       crps</span></span>
<span><span class="co">## 6  1.55416700           1            0.9            6       crps</span></span>
<span><span class="co">## 7  1.51028900           1            0.9            7       crps</span></span>
<span><span class="co">## 8  0.62121225           1            0.9            8       crps</span></span>
<span><span class="co">## 9  0.62630125           1            0.9            9       crps</span></span>
<span><span class="co">## 10 0.59853100           1            0.9           10       crps</span></span>
<span><span class="co">## 11 1.30998625           1            0.9           11       crps</span></span>
<span><span class="co">## 12 2.04829775           1            0.9           12       crps</span></span>
<span><span class="co">## 13 0.61251800           1            0.9           13       crps</span></span>
<span><span class="co">## 14 0.14052300           1            0.9           14       crps</span></span>
<span><span class="co">## 15 0.65110800           1            0.9           15       crps</span></span>
<span><span class="co">## 16 0.07973125           1            0.9           16       crps</span></span>
<span><span class="co">## 17 0.07675600           1            0.9           17       crps</span></span>
<span><span class="co">## 18 0.09382375           1            0.9           18       crps</span></span>
<span><span class="co">## 19 0.12356725           1            0.9           19       crps</span></span>
<span><span class="co">## 20         NA          NA            0.9           20       crps</span></span>
<span><span class="co">## 21 0.20173600           1            0.9           21       crps</span></span>
<span><span class="co">## 22 0.84066825           1            0.9           22       crps</span></span>
<span><span class="co">## 23         NA          NA            0.9           23       crps</span></span>
<span><span class="co">## 24 1.06489225           1            0.9           24       crps</span></span>
<span><span class="co">## 25 0.75528825           1            0.9           25       crps</span></span></code></pre>
<p>The returned list contains a <code>data.frame</code> for each series
in the data that shows the CRPS score for each evaluation in the testing
data, along with some other useful information about the fit of the
forecast distribution. In particular, we are given a logical value (1s
and 0s) telling us whether the true value was within a pre-specified
credible interval (i.e. the coverage of the forecast distribution). The
default interval width is 0.9, so we would hope that the values in the
<code>in_interval</code> column take a 1 approximately 90% of the time.
This value can be changed if you wish to compute different coverages,
say using a 60% interval:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">'crps'</span>, interval_width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span></span></code></pre></div>
<pre><code><span><span class="co">##         score in_interval interval_width eval_horizon score_type</span></span>
<span><span class="co">## 1  0.19375525           1            0.6            1       crps</span></span>
<span><span class="co">## 2  0.13663925           1            0.6            2       crps</span></span>
<span><span class="co">## 3  1.35502175           0            0.6            3       crps</span></span>
<span><span class="co">## 4          NA          NA            0.6            4       crps</span></span>
<span><span class="co">## 5  0.03482775           1            0.6            5       crps</span></span>
<span><span class="co">## 6  1.55416700           0            0.6            6       crps</span></span>
<span><span class="co">## 7  1.51028900           0            0.6            7       crps</span></span>
<span><span class="co">## 8  0.62121225           1            0.6            8       crps</span></span>
<span><span class="co">## 9  0.62630125           1            0.6            9       crps</span></span>
<span><span class="co">## 10 0.59853100           1            0.6           10       crps</span></span>
<span><span class="co">## 11 1.30998625           0            0.6           11       crps</span></span>
<span><span class="co">## 12 2.04829775           0            0.6           12       crps</span></span>
<span><span class="co">## 13 0.61251800           1            0.6           13       crps</span></span>
<span><span class="co">## 14 0.14052300           1            0.6           14       crps</span></span>
<span><span class="co">## 15 0.65110800           1            0.6           15       crps</span></span>
<span><span class="co">## 16 0.07973125           1            0.6           16       crps</span></span>
<span><span class="co">## 17 0.07675600           1            0.6           17       crps</span></span>
<span><span class="co">## 18 0.09382375           1            0.6           18       crps</span></span>
<span><span class="co">## 19 0.12356725           1            0.6           19       crps</span></span>
<span><span class="co">## 20         NA          NA            0.6           20       crps</span></span>
<span><span class="co">## 21 0.20173600           1            0.6           21       crps</span></span>
<span><span class="co">## 22 0.84066825           1            0.6           22       crps</span></span>
<span><span class="co">## 23         NA          NA            0.6           23       crps</span></span>
<span><span class="co">## 24 1.06489225           1            0.6           24       crps</span></span>
<span><span class="co">## 25 0.75528825           1            0.6           25       crps</span></span></code></pre>
<p>We can also compare forecasts against out of sample observations
using the <a href="https://link.springer.com/article/10.1007/s11222-016-9696-4" target="_blank" class="external-link">Expected Log Predictive Density (ELPD; also known as the
log score)</a>. The ELPD is a strictly proper scoring rule that can be
applied to any distributional forecast, but to compute it we need
predictions on the link scale rather than on the outcome scale. This is
where it is advantageous to change the type of prediction we can get
using the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">link_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod1</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>, type <span class="op">=</span> <span class="st">'link'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">link_mod1</span>, score <span class="op">=</span> <span class="st">'elpd'</span><span class="op">)</span><span class="op">$</span><span class="va">series_1</span></span></code></pre></div>
<pre><code><span><span class="co">##         score eval_horizon score_type</span></span>
<span><span class="co">## 1  -0.5304414            1       elpd</span></span>
<span><span class="co">## 2  -0.4298955            2       elpd</span></span>
<span><span class="co">## 3  -2.9617583            3       elpd</span></span>
<span><span class="co">## 4          NA            4       elpd</span></span>
<span><span class="co">## 5  -0.2007644            5       elpd</span></span>
<span><span class="co">## 6  -3.3781408            6       elpd</span></span>
<span><span class="co">## 7  -3.2729088            7       elpd</span></span>
<span><span class="co">## 8  -2.0363750            8       elpd</span></span>
<span><span class="co">## 9  -2.0670612            9       elpd</span></span>
<span><span class="co">## 10 -2.0844818           10       elpd</span></span>
<span><span class="co">## 11 -3.0576463           11       elpd</span></span>
<span><span class="co">## 12 -3.6291058           12       elpd</span></span>
<span><span class="co">## 13 -2.1692669           13       elpd</span></span>
<span><span class="co">## 14 -0.2960899           14       elpd</span></span>
<span><span class="co">## 15 -2.3738851           15       elpd</span></span>
<span><span class="co">## 16 -0.2160804           16       elpd</span></span>
<span><span class="co">## 17 -0.2036782           17       elpd</span></span>
<span><span class="co">## 18 -0.2115539           18       elpd</span></span>
<span><span class="co">## 19 -0.2235072           19       elpd</span></span>
<span><span class="co">## 20         NA           20       elpd</span></span>
<span><span class="co">## 21 -0.2413680           21       elpd</span></span>
<span><span class="co">## 22 -2.6791984           22       elpd</span></span>
<span><span class="co">## 23         NA           23       elpd</span></span>
<span><span class="co">## 24 -2.6851981           24       elpd</span></span>
<span><span class="co">## 25 -0.2836901           25       elpd</span></span></code></pre>
<p>Finally, when we have multiple time series it may also make sense to
use a multivariate proper scoring rule. <code>mvgam</code> offers two
such options: the Energy score and the Variogram score. The first
penalizes forecast distributions that are less well calibrated against
the truth, while the second penalizes forecasts that do not capture the
observed true correlation structure. Which score to use depends on your
goals, but both are very easy to compute:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">energy_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod2</span>, score <span class="op">=</span> <span class="st">'energy'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">energy_mod2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 4</span></span>
<span><span class="co">##  $ series_1  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 NA 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ series_2  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 1 1 1 1 1 1 NA ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ series_3  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ in_interval   : num [1:25] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">##   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ all_series:'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ score       : num [1:25] 0.773 1.147 1.226 NA 0.458 ...</span></span>
<span><span class="co">##   ..$ eval_horizon: int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##   ..$ score_type  : chr [1:25] "energy" "energy" "energy" "energy" ...</span></span></code></pre>
<p>The returned object still provides information on interval coverage
for each individual series, but there is only a single score per horizon
now (which is provided in the <code>all_series</code> slot):</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">energy_mod2</span><span class="op">$</span><span class="va">all_series</span></span></code></pre></div>
<pre><code><span><span class="co">##        score eval_horizon score_type</span></span>
<span><span class="co">## 1  0.7728517            1     energy</span></span>
<span><span class="co">## 2  1.1469836            2     energy</span></span>
<span><span class="co">## 3  1.2258781            3     energy</span></span>
<span><span class="co">## 4         NA            4     energy</span></span>
<span><span class="co">## 5  0.4577536            5     energy</span></span>
<span><span class="co">## 6  1.8094487            6     energy</span></span>
<span><span class="co">## 7  1.4887317            7     energy</span></span>
<span><span class="co">## 8  0.7651593            8     energy</span></span>
<span><span class="co">## 9  1.1180634            9     energy</span></span>
<span><span class="co">## 10        NA           10     energy</span></span>
<span><span class="co">## 11 1.5008324           11     energy</span></span>
<span><span class="co">## 12 3.2142460           12     energy</span></span>
<span><span class="co">## 13 1.6129732           13     energy</span></span>
<span><span class="co">## 14 1.2704438           14     energy</span></span>
<span><span class="co">## 15 1.1335958           15     energy</span></span>
<span><span class="co">## 16 1.8717420           16     energy</span></span>
<span><span class="co">## 17        NA           17     energy</span></span>
<span><span class="co">## 18 0.7953392           18     energy</span></span>
<span><span class="co">## 19 0.9919119           19     energy</span></span>
<span><span class="co">## 20        NA           20     energy</span></span>
<span><span class="co">## 21 1.2461964           21     energy</span></span>
<span><span class="co">## 22 1.5170615           22     energy</span></span>
<span><span class="co">## 23        NA           23     energy</span></span>
<span><span class="co">## 24 2.3824552           24     energy</span></span>
<span><span class="co">## 25 1.5314557           25     energy</span></span></code></pre>
<p>You can use your score(s) of choice to compare different models. For
example, we can compute and plot the difference in CRPS scores for each
series in data. Here, a negative value means the Gaussian Process model
(<code>mod2</code>) is better, while a positive value means the spline
model (<code>mod1</code>) is better.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">'crps'</span><span class="op">)</span></span>
<span><span class="va">crps_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod2</span>, score <span class="op">=</span> <span class="st">'crps'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_1</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">'darkred'</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Forecast horizon'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">GP</span><span class="op">]</span><span class="op">~</span><span class="op">-</span><span class="op">~</span><span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">'dashed'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gp_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'GP better in '</span>, <span class="va">gp_better</span>, <span class="st">' of 25 evaluations'</span>,</span>
<span>                    <span class="st">'\nMean difference = '</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-29-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_2</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_2</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">'darkred'</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Forecast horizon'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">GP</span><span class="op">]</span><span class="op">~</span><span class="op">-</span><span class="op">~</span><span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">'dashed'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gp_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'GP better in '</span>, <span class="va">gp_better</span>, <span class="st">' of 25 evaluations'</span>,</span>
<span>                    <span class="st">'\nMean difference = '</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-29-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_3</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_3</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">'darkred'</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Forecast horizon'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">GP</span><span class="op">]</span><span class="op">~</span><span class="op">-</span><span class="op">~</span><span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">'dashed'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">gp_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'GP better in '</span>, <span class="va">gp_better</span>, <span class="st">' of 25 evaluations'</span>,</span>
<span>                    <span class="st">'\nMean difference = '</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-29-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>The GP model consistently gives better forecasts, and the difference
between scores grows quickly as the forecast horizon increases. This is
not unexpected given the way that splines linearly extrapolate outside
the range of training data</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>The following papers and resources offer useful material about
Bayesian forecasting and proper scoring rules:</p>
<p>Hyndman, Rob J., and George Athanasopoulos. <a href="https://otexts.com/fpp3/distaccuracy.html" class="external-link">Forecasting: principles
and practice</a>. <em>OTexts</em>, 2018.</p>
<p>Gneiting, Tilmann, and Adrian E. Raftery. <a href="https://www.tandfonline.com/doi/abs/10.1198/016214506000001437" class="external-link">Strictly
proper scoring rules, prediction, and estimation</a> <em>Journal of the
American statistical Association</em> 102.477 (2007) 359-378.</p>
<p>Simonis, Juniper L., Ethan P. White, and SK Morgan Ernest. <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.3431" class="external-link">Evaluating
probabilistic ecological forecasts</a> <em>Ecology</em> 102.8 (2021)
e03431.</p>
</div>
<div class="section level2">
<h2 id="interested-in-contributing">Interested in contributing?<a class="anchor" aria-label="anchor" href="#interested-in-contributing"></a>
</h2>
<p>I’m actively seeking PhD students and other researchers to work in
the areas of ecological forecasting, multivariate model evaluation and
development of <code>mvgam</code>. Please reach out if you are
interested (n.clark’at’uq.edu.au)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://researchers.uq.edu.au/researcher/15140" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
