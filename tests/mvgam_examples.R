# Small mvgam examples for testing post-fitting functions such as
# predict, forecast, hindcast etc...
testthat::skip_on_cran()
set.seed(1234)
library(mvgam)
mvgam_examp_dat <- list(data_train =
                          structure(list(y = c(-0.317295790188251, 0.220334092025582,
                                               -0.23429845120413, -0.190120275631535, -0.721932341073365, -0.536319229285967,
                                               1.07847872341093, 0.528603309959222, -1.01029789615038, 0.238298670523412,
                                               NA, -0.444340550801068, 0.456096348726352, -0.420692740561866,
                                               -0.742889688350737, 0.822064221538723, 0.328252004185904, NA,
                                               1.15865038871535, 0.758985000688948, 0.48275689223424, 0.224473673246168,
                                               1.1190450787569, 1.56392608482435, 1.5362529924526, 0.385495173237471,
                                               1.00066681489395, 2.11596191241963, 1.61704552652644, 1.45913579992691,
                                               1.2435334833712, 0.631729386400507, 0.576559210249755, 0.0722044157736635,
                                               0.26455782546669, 0.225087826150757, NA, NA, 0.818259498073809,
                                               -0.163140469241983, -0.739122372257734, -0.038798792762058, NA,
                                               -1.09717617631874, -1.0086946341122, -0.000339073139587032, NA,
                                               -0.669753725342153, -0.183911023847314, 0.101919525400811, 0.750119208154569,
                                               0.608475388247533, 0.157949561737808, NA, 1.25064957854874, 1.37594610668097,
                                               0.481177430075957, 1.36802299674497, 1.93032960712934, 1.43201850345734,
                                               2.31392469058045, 1.82181003864255, 1.71278963823893, 0.866808435795544,
                                               2.42429457915255, 1.83733164108041, 1.18306621353626, 1.46182253806335,
                                               1.0682262712598, 0.299584951079789, 0.441131055660565, -0.248636636439559,
                                               0.272502050835697, -0.492868536450178, NA, -0.284210983663747,
                                               -0.603761222038685, 0.309033697532796, -0.332252779765235, -0.533075017006035,
                                               -0.0436322918905076, -0.504775368621498, 0.432534318123723, -0.567702364334402,
                                               0.0175957297329464, 0.573299967950103, -0.151243391288708, 1.20869154072744,
                                               0.574687322356463, 2.23085278511223),
                                         season = c(1L, 1L, 1L,
                                                    2L, 2L, 2L, 3L, 3L, 3L, 4L, 4L, 4L, 5L, 5L, 5L, 6L, 6L, 6L, 7L,
                                                    7L, 7L, 8L, 8L, 8L, 9L, 9L, 9L, 10L, 10L, 10L, 11L, 11L, 11L,
                                                    12L, 12L, 12L, 1L, 1L, 1L, 2L, 2L, 2L, 3L, 3L, 3L, 4L, 4L, 4L,
                                                    5L, 5L, 5L, 6L, 6L, 6L, 7L, 7L, 7L, 8L, 8L, 8L, 9L, 9L, 9L, 10L,
                                                    10L, 10L, 11L, 11L, 11L, 12L, 12L, 12L, 1L, 1L, 1L, 2L, 2L, 2L,
                                                    3L, 3L, 3L, 4L, 4L, 4L, 5L, 5L, 5L, 6L, 6L, 6L),
                                         year = c(1L,
                                                  1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                  1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                  1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                                                  2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,
                                                  2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
                                                  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L),
                                         series = structure(c(1L,
                                                              2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L,
                                                              3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L,
                                                              1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L,
                                                              2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L,
                                                              3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L,
                                                              1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L),
                                                            levels = c("series_1", "series_2",
                                                                       "series_3"),
                                                            class = "factor"),
                                         time = c(1L, 1L, 1L, 2L, 2L,
                                                  2L, 3L, 3L, 3L, 4L, 4L, 4L, 5L, 5L, 5L, 6L, 6L, 6L, 7L, 7L, 7L,
                                                  8L, 8L, 8L, 9L, 9L, 9L, 10L, 10L, 10L, 11L, 11L, 11L, 12L, 12L,
                                                  12L, 13L, 13L, 13L, 14L, 14L, 14L, 15L, 15L, 15L, 16L, 16L, 16L,
                                                  17L, 17L, 17L, 18L, 18L, 18L, 19L, 19L, 19L, 20L, 20L, 20L, 21L,
                                                  21L, 21L, 22L, 22L, 22L, 23L, 23L, 23L, 24L, 24L, 24L, 25L, 25L,
                                                  25L, 26L, 26L, 26L, 27L, 27L, 27L, 28L, 28L, 28L, 29L, 29L, 29L,
                                                  30L, 30L, 30L)),
                                    class = "data.frame",
                                    row.names = c(NA, -90L
                                    )),
                        data_test = structure(
                          list(y = c(1.9225415658891, 0.980497395765498,
                                     NA, NA, 1.99180134346589, 2.18217735640189, 1.72099793300185,
                                     2.12310134911861, 2.1873048858936, 1.45864688333387, 3.10851051751545,
                                     1.87889016262817, 2.67339313652116, 1.73417970021132, 1.02261070908916,
                                     NA, 0.257669985859535, -0.137288229556638, -0.235030086856228,
                                     0.497416594429372, -0.334416428844163, -0.311532347109851, -0.537442038805868,
                                     -0.169731327598491, -0.169279959367058, NA, -0.663454313574706,
                                     -0.444260836470006, 0.377207972777161, 0.0373404427681032),
                               season = c(7L,
                                          7L, 7L, 8L, 8L, 8L, 9L, 9L, 9L, 10L, 10L, 10L, 11L, 11L, 11L,
                                          12L, 12L, 12L, 1L, 1L, 1L, 2L, 2L, 2L, 3L, 3L, 3L, 4L, 4L, 4L
                               ),
                               year = c(3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
                                        3L, 3L, 3L, 3L, 3L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L,
                                        4L),
                               series = structure(c(1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L,
                                                    1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L,
                                                    2L, 3L, 1L, 2L, 3L),
                                                  levels = c("series_1", "series_2", "series_3"
                                                  ),
                                                  class = "factor"),
                               time = c(31L, 31L, 31L, 32L, 32L, 32L,
                                        33L, 33L, 33L, 34L, 34L, 34L, 35L, 35L, 35L, 36L, 36L, 36L, 37L,
                                        37L, 37L, 38L, 38L, 38L, 39L, 39L, 39L, 40L, 40L, 40L)),
                          class = "data.frame",
                          row.names = c(NA,
                                        -30L)),
                        true_corrs = structure(c(1, -0.0493047869428226, -0.359214699594171,
                                                 -0.0493047869428226, 1, 0.0965714799209643, -0.359214699594171,
                                                 0.0965714799209643, 1),
                                               dim = c(3L, 3L)),
                        true_trends = structure(c(-0.344493885597773,
                                                  -0.232300337648349, 1.18636960097798, 2.16297062543309, 1.54481971836177,
                                                  0.81834416147252, 0.305248532800197, -1.43337411326605, -0.559358127678545,
                                                  0.801175101371101, -0.874479561796756, -1.49757544423459, -1.47938552521932,
                                                  -0.779020622710978, -1.42156384282181, -0.559388660336436, -0.186351529091869,
                                                  0.121764381676041, 0.126736696300108, 0.0893667428674084, 0.80833465784013,
                                                  0.315032014287232, 0.326348348989977, 0.336140088113638, 1.00971953020001,
                                                  2.03216049826035, 0.314596106312253, -1.87450328430068, -1.33508781812581,
                                                  -1.31380884746884, -1.15236761215408, 0.0807967358922978, 0.858159305706361,
                                                  0.905947136907826, -0.559246833883322, -0.126498942172878, -0.196481639257041,
                                                  -0.0860543148331441, 1.1786407870955, 0.688670171732476, -0.0854369655025306,
                                                  -0.283039802028598, -0.391044765275137, -0.660316040600317, -1.0825805592583,
                                                  -1.38785082987726, -1.66653412504728, -1.34146462277164, -1.48137417794573,
                                                  -1.28262502169839, -0.953139794480322, -0.576708311281916, -0.713569153631598,
                                                  -0.711618859080297, -0.82444743840602, -0.742528471370009, -0.788923087487961,
                                                  -0.808240703044327, -0.749081156856182, -0.480801532007975, 0.0295947548017,
                                                  0.0184318512707251, 0.0961560086601808, 0.135860621641731, 0.182169602799116,
                                                  0.00446727095450795, 0.252465931030096, 0.793251155329183, 1.51535621737829,
                                                  1.54849010413875, 1.59422844587052, 1.41354721273425, 1.49750166286349,
                                                  1.14952470313615, 1.04125186119256, 1.09212299883214, 1.04812469944662,
                                                  1.21626825333005, 1.252890474704, 1.12962158753773, -1.88819733110982,
                                                  -1.54138941284108, -1.30787739117563, -1.17390781480333, -1.14715912878263,
                                                  -0.872025611735487, -0.639005219327742, -0.730199627842207, 0.0920846688603714,
                                                  -0.126625566858376, 0.136581389317326, 0.697590314197646, 0.895556951540955,
                                                  1.28572485694027, 0.586157195736808, 0.425779423347083, 0.425351932174315,
                                                  0.267353747053586, 0.262112429929249, 0.325514330140494, 0.652328530358018,
                                                  0.352055138917514, 0.162661639152412, 1.03324983842772, 0.773002157784822,
                                                  0.958485578721759, 0.936829335965585, 1.00727253580573, 1.31958208257525,
                                                  1.41155021536019, 1.19191018911078, 1.25160854501085, 0.229671675485045,
                                                  0.248576039607507, -0.461003969073842, -0.693200816509763, -1.17351428896702,
                                                  -1.9801118028558, -1.72933032204091, -1.46504243759765),
                                                dim = c(40L,
                                                        3L)),
                        global_seasonality = c(-0.44196698367102, -1.10945940710463,
                                               -0.928514333180411, -1.1808034521295, -0.828715870974577, 0.801683742888759,
                                               0.645341660120218, 1.31283408355383, 1.13188900962961, 1.3841781285787,
                                               1.03209054742378, -0.598309066439561, -0.44196698367102, -1.10945940710463,
                                               -0.928514333180411, -1.1808034521295, -0.828715870974577, 0.801683742888759,
                                               0.645341660120218, 1.31283408355383, 1.13188900962961, 1.3841781285787,
                                               1.03209054742378, -0.598309066439561, -0.44196698367102, -1.10945940710463,
                                               -0.928514333180411, -1.1808034521295, -0.828715870974577, 0.801683742888759,
                                               0.645341660120218, 1.31283408355383, 1.13188900962961, 1.3841781285787,
                                               1.03209054742378, -0.598309066439561, -0.44196698367102, -1.10945940710463,
                                               -0.928514333180411, -1.1808034521295),
                        trend_params = list(ar1 = c(1,
                                                    1, 1),
                                            ar2 = c(0, 0, 0),
                                            ar3 = c(0, 0, 0)))

# Univariate process without trend_formula
mvgam_example1 <- mvgam(y ~ s(season, k = 5),
                        trend_model = RW(),
                        family = gaussian(),
                        data = mvgam_examp_dat$data_train,
                        burnin = 300,
                        samples = 30,
                        chains = 1,
                        backend = 'rstan')

# Univariate process with trend_formula, trend_map and correlated process errors
trend_map <- data.frame(series = unique(mvgam_examp_dat$data_train$series),
                        trend = c(1,1,2))
mvgam_example2 <- mvgam(y ~ 1,
                        trend_formula = ~ s(season, k = 5),
                        trend_model = RW(cor = TRUE),
                        trend_map = trend_map,
                        family = gaussian(),
                        data = mvgam_examp_dat$data_train,
                        burnin = 300,
                        samples = 30,
                        chains = 1,
                        backend = 'rstan')

# Multivariate process without trend_formula
mvgam_example3 <- mvgam(y ~ s(season, k = 5),
                        trend_model = VAR(cor = TRUE),
                        family = gaussian(),
                        data = mvgam_examp_dat$data_train,
                        burnin = 300,
                        samples = 30,
                        chains = 1,
                        backend = 'rstan')

# Multivariate process with trend_formula and moving averages
mvgam_example4 <- mvgam(y ~ series,
                        trend_formula = ~ s(season, k = 5),
                        trend_model = VAR(ma = TRUE, cor = TRUE),
                        family = gaussian(),
                        data = mvgam_examp_dat$data_train,
                        burnin = 300,
                        samples = 30,
                        chains = 1,
                        backend = 'rstan')

# GP dynamic factors (use list format to ensure it works in tests)
list_data <- list()
for(i in 1:NCOL(mvgam_examp_dat$data_train)){
  list_data[[i]] <- mvgam_examp_dat$data_train[ , i]
}
names(list_data) <- colnames(mvgam_examp_dat$data_train)
mvgam_example5 <- mvgam(y ~ series + s(season, k = 5),
                        trend_model = GP(),
                        family = gaussian(),
                        use_lv = TRUE,
                        n_lv = 2,
                        data = list_data,
                        burnin = 300,
                        samples = 30,
                        chains = 1,
                        backend = 'rstan')

# Save examples as internal data
usethis::use_data(
  mvgam_examp_dat,
  mvgam_example1,
  mvgam_example2,
  mvgam_example3,
  mvgam_example4,
  mvgam_example5,
  internal = TRUE,
  overwrite = TRUE
)
