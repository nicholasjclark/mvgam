<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mvgam">
<title>Forecasting and forecast evaluation in mvgam â€¢ mvgam</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Forecasting and forecast evaluation in mvgam">
<meta property="og:description" content="mvgam">
<meta property="og:image" content="https://nicholasjclark.github.io/mvgam/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mvgam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_in_mvgam.html">Formatting data for use in mvgam</a>
    <a class="dropdown-item" href="../articles/forecast_evaluation.html">Forecasting and forecast evaluation in mvgam</a>
    <a class="dropdown-item" href="../articles/mvgam_overview.html">Overview of the mvgam package</a>
    <a class="dropdown-item" href="../articles/nmixtures.html">N-mixtures in mvgam</a>
    <a class="dropdown-item" href="../articles/shared_states.html">Shared latent states in mvgam</a>
    <a class="dropdown-item" href="../articles/time_varying_effects.html">Time-varying effects in mvgam</a>
    <a class="dropdown-item" href="../articles/trend_formulas.html">State-Space models in mvgam</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nicholasjclark/mvgam/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Forecasting and forecast evaluation in mvgam</h1>
                        <h4 data-toc-skip class="author">Nicholas J
Clark</h4>
            
            <h4 data-toc-skip class="date">2025-03-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasjclark/mvgam/blob/HEAD/vignettes/forecast_evaluation.Rmd" class="external-link"><code>vignettes/forecast_evaluation.Rmd</code></a></small>
      <div class="d-none name"><code>forecast_evaluation.Rmd</code></div>
    </div>

    
    
<p>The purpose of this vignette is to show how the <code>mvgam</code>
package can be used to produce probabilistic forecasts and to evaluate
those forecasts using a variety of proper scoring rules.</p>
<div class="section level2">
<h2 id="simulating-discrete-time-series">Simulating discrete time series<a class="anchor" aria-label="anchor" href="#simulating-discrete-time-series"></a>
</h2>
<p>We begin by simulating some data to show how forecasts are computed
and evaluated in <code>mvgam</code>. The <code><a href="../reference/sim_mvgam.html">sim_mvgam()</a></code>
function can be used to simulate series that come from a variety of
response distributions as well as seasonal patterns and/or dynamic
temporal patterns. Here we simulate a collection of three time
count-valued series. These series all share the same seasonal pattern
but have different temporal dynamics. By setting
<code>trend_model = GP()</code> and <code>prop_trend = 0.75</code>, we
are generating time series that have smooth underlying temporal trends
(evolving as Gaussian Processes with squared exponential kernel) and
moderate seasonal patterns. The observations are Poisson-distributed and
we allow 10% of observations to be missing.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">simdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_mvgam.html">sim_mvgam</a></span><span class="op">(</span></span>
<span>  T <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_series <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  mu <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  trend_model <span class="op">=</span> <span class="fu"><a href="../reference/GP.html">GP</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prop_trend <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prop_missing <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The returned object is a <code>list</code> containing training and
testing data (<code><a href="../reference/sim_mvgam.html">sim_mvgam()</a></code> automatically splits the data
into these folds for us) together with some other information about the
data generating process that was used to simulate the data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">simdat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ data_train        :'data.frame':  225 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ y     : int [1:225] 6 NA 11 2 5 20 7 8 NA 11 ...</span></span>
<span><span class="co">#&gt;   ..$ season: int [1:225] 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">#&gt;   ..$ year  : int [1:225] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ series: Factor w/ 3 levels "series_1","series_2",..: 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co">#&gt;   ..$ time  : int [1:225] 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">#&gt;  $ data_test         :'data.frame':  75 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ y     : int [1:75] 4 23 8 3 NA 3 1 20 8 3 ...</span></span>
<span><span class="co">#&gt;   ..$ season: int [1:75] 4 4 4 5 5 5 6 6 6 7 ...</span></span>
<span><span class="co">#&gt;   ..$ year  : int [1:75] 7 7 7 7 7 7 7 7 7 7 ...</span></span>
<span><span class="co">#&gt;   ..$ series: Factor w/ 3 levels "series_1","series_2",..: 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co">#&gt;   ..$ time  : int [1:75] 76 76 76 77 77 77 78 78 78 79 ...</span></span>
<span><span class="co">#&gt;  $ true_corrs        : num [1:3, 1:3] 1 0.0861 0.1161 0.0861 1 ...</span></span>
<span><span class="co">#&gt;  $ true_trends       : num [1:100, 1:3] -0.851 -0.758 -0.664 -0.571 -0.48 ...</span></span>
<span><span class="co">#&gt;  $ global_seasonality: num [1:100] -0.966 -0.197 0.771 1.083 0.37 ...</span></span>
<span><span class="co">#&gt;  $ trend_params      :List of 2</span></span>
<span><span class="co">#&gt;   ..$ alpha: num [1:3] 0.883 0.936 1.036</span></span>
<span><span class="co">#&gt;   ..$ rho  : num [1:3] 7.54 4.01 7.49</span></span></code></pre></div>
<p>Each series in this case has a shared seasonal pattern. The resulting
time series are similar to what we might encounter when dealing with
count-valued data that can take small counts:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>  series <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-4-1.png" alt="Plotting time series features for GAM models in mvgam" width="60%" style="display: block; margin: auto;"></p>
<p>For individual series, we can plot the training and testing data, as
well as some more specific features of the observed data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mvgam_series.html">plot_mvgam_series</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>,</span>
<span>  series <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-5-1.png" alt="Plotting time series features for GAM models in mvgam" width="60%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="modelling-dynamics-with-splines">Modelling dynamics with splines<a class="anchor" aria-label="anchor" href="#modelling-dynamics-with-splines"></a>
</h3>
<p>The first model we will fit uses a shared cyclic spline to capture
the repeated seasonality, as well as series-specific splines of time to
capture the long-term dynamics. We allow the temporal splines to be
fairly complex so they can capture as much of the temporal variation as
possible:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">time</span>, by <span class="op">=</span> <span class="va">series</span>, bs <span class="op">=</span> <span class="st">"cr"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trend_model <span class="op">=</span> <span class="st">"None"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The model fits without issue:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span>, include_betas <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; GAM formula:</span></span>
<span><span class="co">#&gt; y ~ s(season, bs = "cc", k = 8) + s(time, by = series, k = 20)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family:</span></span>
<span><span class="co">#&gt; poisson</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Link function:</span></span>
<span><span class="co">#&gt; log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Trend model:</span></span>
<span><span class="co">#&gt; None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N series:</span></span>
<span><span class="co">#&gt; 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N timepoints:</span></span>
<span><span class="co">#&gt; 100 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Status:</span></span>
<span><span class="co">#&gt; Fitted using Stan </span></span>
<span><span class="co">#&gt; 4 chains, each with iter = 1000; warmup = 500; thin = 1 </span></span>
<span><span class="co">#&gt; Total post-warmup draws = 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; GAM coefficient (beta) estimates:</span></span>
<span><span class="co">#&gt;             2.5% 50% 97.5% Rhat n_eff</span></span>
<span><span class="co">#&gt; (Intercept)  1.9 1.9     2    1  1675</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of GAM smooths:</span></span>
<span><span class="co">#&gt;                         edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(season)              3.80      6   19.9 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; s(time):seriesseries_1 8.22     19   39.1 0.47727    </span></span>
<span><span class="co">#&gt; s(time):seriesseries_2 8.74     19   45.6 0.00092 ***</span></span>
<span><span class="co">#&gt; s(time):seriesseries_3 6.49     19   55.6 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Stan MCMC diagnostics:</span></span>
<span><span class="co">#&gt; âœ” No issues with effective samples per iteration</span></span>
<span><span class="co">#&gt; âœ– Rhats above 1.05 found for some parameters</span></span>
<span><span class="co">#&gt;     Use pairs() and mcmc_plot() to investigate</span></span>
<span><span class="co">#&gt; âœ” No issues with divergences</span></span>
<span><span class="co">#&gt; âœ– 43 of 2000 iterations saturated the maximum tree depth of 10 (2.15%)</span></span>
<span><span class="co">#&gt;     Try a larger max_treedepth to avoid saturation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using sampling(hmc). For each parameter, n_eff is a</span></span>
<span><span class="co">#&gt;   crude measure of effective sample size, and Rhat is the potential scale</span></span>
<span><span class="co">#&gt;   reduction factor on split MCMC chains (at convergence, Rhat = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use how_to_cite() to get started describing this model</span></span></code></pre></div>
<p>And we can plot the conditional effects of the splines (on the link
scale) to see that they are estimated to be highly nonlinear</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/conditional_effects.brmsfit.html" class="external-link">conditional_effects</a></span><span class="op">(</span><span class="va">mod1</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-9-1.png" alt="Plotting GAM smooth functions using mvgam" width="60%" style="display: block; margin: auto;"><img src="forecast_evaluation_files/figure-html/unnamed-chunk-9-2.png" alt="Plotting GAM smooth functions using mvgam" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="modelling-dynamics-with-a-correlated-ar1">Modelling dynamics with a correlated AR1<a class="anchor" aria-label="anchor" href="#modelling-dynamics-with-a-correlated-ar1"></a>
</h3>
<p>Before showing how to produce and evaluate forecasts, we will fit a
second model to these data so the two models can be compared. This model
is equivalent to the above, except we now use a correlated AR(1) process
to model series-specific dynamics. See <code><a href="../reference/RW.html">?AR</a></code> for more
details.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  trend_formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  trend_knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trend_model <span class="op">=</span> <span class="fu"><a href="../reference/RW.html">AR</a></span><span class="op">(</span>cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  noncentred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The summary for this model now contains information on the
autoregressive and process error parameters for each time series:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span>, include_betas <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; GAM observation formula:</span></span>
<span><span class="co">#&gt; y ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; GAM process formula:</span></span>
<span><span class="co">#&gt; ~s(season, bs = "cc", k = 8) - 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family:</span></span>
<span><span class="co">#&gt; poisson</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Link function:</span></span>
<span><span class="co">#&gt; log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Trend model:</span></span>
<span><span class="co">#&gt; AR(cor = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N process models:</span></span>
<span><span class="co">#&gt; 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N series:</span></span>
<span><span class="co">#&gt; 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N timepoints:</span></span>
<span><span class="co">#&gt; 75 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Status:</span></span>
<span><span class="co">#&gt; Fitted using Stan </span></span>
<span><span class="co">#&gt; 4 chains, each with iter = 1000; warmup = 500; thin = 1 </span></span>
<span><span class="co">#&gt; Total post-warmup draws = 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; GAM observation model coefficient (beta) estimates:</span></span>
<span><span class="co">#&gt;             2.5% 50% 97.5% Rhat n_eff</span></span>
<span><span class="co">#&gt; (Intercept)  1.7   2   2.4    1   706</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Process model AR parameter estimates:</span></span>
<span><span class="co">#&gt;        2.5%  50% 97.5% Rhat n_eff</span></span>
<span><span class="co">#&gt; ar1[1] 0.74 0.89  0.99 1.00   688</span></span>
<span><span class="co">#&gt; ar1[2] 0.66 0.82  0.95 1.01   639</span></span>
<span><span class="co">#&gt; ar1[3] 0.87 0.96  1.00 1.00   625</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Process error parameter estimates:</span></span>
<span><span class="co">#&gt;          2.5%  50% 97.5% Rhat n_eff</span></span>
<span><span class="co">#&gt; sigma[1] 0.24 0.33  0.44 1.00   574</span></span>
<span><span class="co">#&gt; sigma[2] 0.31 0.43  0.59 1.01   495</span></span>
<span><span class="co">#&gt; sigma[3] 0.19 0.26  0.36 1.02   314</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of GAM process smooths:</span></span>
<span><span class="co">#&gt;            edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">#&gt; s(season) 2.29      6   20.6 3.3e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Stan MCMC diagnostics:</span></span>
<span><span class="co">#&gt; âœ” No issues with effective samples per iteration</span></span>
<span><span class="co">#&gt; âœ” Rhat looks good for all parameters</span></span>
<span><span class="co">#&gt; âœ” No issues with divergences</span></span>
<span><span class="co">#&gt; âœ” No issues with maximum tree depth</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using sampling(hmc). For each parameter, n_eff is a</span></span>
<span><span class="co">#&gt;   crude measure of effective sample size, and Rhat is the potential scale</span></span>
<span><span class="co">#&gt;   reduction factor on split MCMC chains (at convergence, Rhat = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use how_to_cite() to get started describing this model</span></span></code></pre></div>
<p>We can plot the posteriors for these parameters, and for any other
parameter for that matter, using <code>bayesplot</code> routines. First
the autoregressive parameters:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/mcmc_plot.brmsfit.html" class="external-link">mcmc_plot</a></span><span class="op">(</span><span class="va">mod2</span>, variable <span class="op">=</span> <span class="st">"ar"</span>, regex <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"areas"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-13-1.png" alt="Summarising latent Gaussian Process parameters in mvgam" width="60%" style="display: block; margin: auto;"></p>
<p>And now the variance (<span class="math inline">\(\sigma\)</span>)
parameters:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/mcmc_plot.brmsfit.html" class="external-link">mcmc_plot</a></span><span class="op">(</span><span class="va">mod2</span>, variable <span class="op">=</span> <span class="st">"sigma"</span>, regex <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"areas"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-14-1.png" alt="Summarising latent Gaussian Process parameters in mvgam" width="60%" style="display: block; margin: auto;"></p>
<p>We can again plot the conditional seasonal effect:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/conditional_effects.brmsfit.html" class="external-link">conditional_effects</a></span><span class="op">(</span><span class="va">mod2</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-15-1.png" alt="Plotting latent Gaussian Process effects in mvgam and marginaleffects" width="60%" style="display: block; margin: auto;"></p>
<p>The estimates for the seasonal component are fairly similar for the
two models, but below we will see if they produce similar forecasts</p>
</div>
</div>
<div class="section level2">
<h2 id="forecasting-with-the-forecast-function">Forecasting with the <code>forecast()</code> function<a class="anchor" aria-label="anchor" href="#forecasting-with-the-forecast-function"></a>
</h2>
<p>Probabilistic forecasts can be computed in two main ways in
<code>mvgam</code>. The first is to take a model that was fit only to
training data (as we did above in the two example models) and produce
temporal predictions from the posterior predictive distribution by
feeding <code>newdata</code> to the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function. It
is crucial that any <code>newdata</code> fed to the
<code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function follows on sequentially from the data
that was used to fit the model (this is not internally checked by the
package because it might be a headache to do so when data are not
supplied in a specific time-order). When calling the
<code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function, you have the option to generate
different kinds of predictions (i.e.Â predicting on the link scale,
response scale or to produce expectations; see
<code><a href="../reference/forecast.mvgam.html">?forecast.mvgam</a></code> for details). We will use the default and
produce forecasts on the response scale, which is the most common way to
evaluate forecast distributions</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod1</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span><span class="op">)</span></span>
<span><span class="va">fc_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod2</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span><span class="op">)</span></span></code></pre></div>
<p>The objects we have created are of class <code>mvgam_forecast</code>,
which contain information on hindcast distributions, forecast
distributions and true observations for each series in the data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fc_mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 16</span></span>
<span><span class="co">#&gt;  $ call              :Class 'formula'  language y ~ s(season, bs = "cc", k = 8) + s(time, by = series, k = 20)</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; </span></span>
<span><span class="co">#&gt;  $ trend_call        : NULL</span></span>
<span><span class="co">#&gt;  $ family            : chr "poisson"</span></span>
<span><span class="co">#&gt;  $ family_pars       : NULL</span></span>
<span><span class="co">#&gt;  $ trend_model       : chr "None"</span></span>
<span><span class="co">#&gt;  $ drift             : logi FALSE</span></span>
<span><span class="co">#&gt;  $ use_lv            : logi FALSE</span></span>
<span><span class="co">#&gt;  $ fit_engine        : chr "stan"</span></span>
<span><span class="co">#&gt;  $ type              : chr "response"</span></span>
<span><span class="co">#&gt;  $ series_names      : Factor w/ 3 levels "series_1","series_2",..: 1 2 3</span></span>
<span><span class="co">#&gt;  $ train_observations:List of 3</span></span>
<span><span class="co">#&gt;   ..$ series_1: int [1:75] 6 2 7 11 8 6 9 11 7 4 ...</span></span>
<span><span class="co">#&gt;   ..$ series_2: int [1:75] NA 5 8 2 1 NA 2 4 0 2 ...</span></span>
<span><span class="co">#&gt;   ..$ series_3: int [1:75] 11 20 NA 36 44 34 57 50 26 28 ...</span></span>
<span><span class="co">#&gt;  $ train_times       : int [1:75] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ test_observations :List of 3</span></span>
<span><span class="co">#&gt;   ..$ series_1: int [1:25] 4 3 1 3 1 NA NA 7 9 8 ...</span></span>
<span><span class="co">#&gt;   ..$ series_2: int [1:25] 23 NA 20 20 14 7 6 6 6 1 ...</span></span>
<span><span class="co">#&gt;   ..$ series_3: int [1:25] 8 3 8 3 NA 1 1 9 8 NA ...</span></span>
<span><span class="co">#&gt;  $ test_times        : int [1:25] 76 77 78 79 80 81 82 83 84 85 ...</span></span>
<span><span class="co">#&gt;  $ hindcasts         :List of 3</span></span>
<span><span class="co">#&gt;   ..$ series_1: num [1:2000, 1:75] 5 4 0 2 0 5 2 4 4 0 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:75] "ypred[1,1]" "ypred[2,1]" "ypred[3,1]" "ypred[4,1]" ...</span></span>
<span><span class="co">#&gt;   ..$ series_2: num [1:2000, 1:75] 1 3 0 1 4 3 3 3 2 3 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:75] "ypred[1,2]" "ypred[2,2]" "ypred[3,2]" "ypred[4,2]" ...</span></span>
<span><span class="co">#&gt;   ..$ series_3: num [1:2000, 1:75] 9 14 15 14 14 16 9 14 17 16 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:75] "ypred[1,3]" "ypred[2,3]" "ypred[3,3]" "ypred[4,3]" ...</span></span>
<span><span class="co">#&gt;  $ forecasts         :List of 3</span></span>
<span><span class="co">#&gt;   ..$ series_1: num [1:2000, 1:25] 2 1 7 2 2 4 3 5 3 1 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:25] "ypred[76,1]" "ypred[77,1]" "ypred[78,1]" "ypred[79,1]" ...</span></span>
<span><span class="co">#&gt;   ..$ series_2: num [1:2000, 1:25] 17 12 15 18 19 20 22 16 15 36 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:25] "ypred[76,2]" "ypred[77,2]" "ypred[78,2]" "ypred[79,2]" ...</span></span>
<span><span class="co">#&gt;   ..$ series_3: num [1:2000, 1:25] 2 3 4 3 3 4 7 2 5 3 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr [1:25] "ypred[76,3]" "ypred[77,3]" "ypred[78,3]" "ypred[79,3]" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "mvgam_forecast"</span></span></code></pre></div>
<p>We can plot the forecasts for some series from each model using the
<code>S3 plot</code> method for objects of this class:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod1</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-18-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-18-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod1</span>, series <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-18-3.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-18-4.png" width="60%" style="display: block; margin: auto;"></p>
<p>Clearly the two models do not produce equivalent forecasts. We will
come back to scoring these forecasts in a moment.</p>
</div>
<div class="section level2">
<h2 id="forecasting-with-newdata-in-mvgam">Forecasting with <code>newdata</code> in <code>mvgam()</code><a class="anchor" aria-label="anchor" href="#forecasting-with-newdata-in-mvgam"></a>
</h2>
<p>The second way we can produce forecasts in <code>mvgam</code> is to
feed the testing data directly to the <code><a href="../reference/mvgam.html">mvgam()</a></code> function as
<code>newdata</code>. This will include the testing data as missing
observations so that they are automatically predicted from the posterior
predictive distribution using the <code>generated quantities</code>
block in <code>Stan</code>. As an example, we can refit
<code>mod2</code> but include the testing data for automatic
forecasts:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvgam.html">mvgam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  trend_formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">season</span>, bs <span class="op">=</span> <span class="st">"cc"</span>, k <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  trend_knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trend_model <span class="op">=</span> <span class="fu"><a href="../reference/RW.html">AR</a></span><span class="op">(</span>cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  noncentred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  data <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_train</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Because the model already contains a forecast distribution, we do not
need to feed <code>newdata</code> to the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code>
function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></code></pre></div>
<p>The forecasts will be nearly identical to those calculated
previously:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc_mod2</span>, series <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-22-1.png" alt="Plotting posterior forecast distributions using mvgam and R" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="scoring-forecast-distributions">Scoring forecast distributions<a class="anchor" aria-label="anchor" href="#scoring-forecast-distributions"></a>
</h2>
<p>A primary purpose of the <code>mvgam_forecast</code> class is to
readily allow forecast evaluations for each series in the data, using a
variety of possible scoring functions. See
<code><a href="../reference/score.mvgam_forecast.html">?mvgam::score.mvgam_forecast</a></code> to view the types of scores
that are available. A useful scoring metric is the <a href="https://www.annualreviews.org/content/journals/10.1146/annurev-statistics-062713-085831" target="_blank" class="external-link">Continuous Rank Probability Score (CRPS)</a>. A CRPS
value is similar to what we might get if we calculated a weighted
absolute error using the full forecast distribution.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">"crps"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">crps_mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ series_1  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ score         : num [1:25] 1.136 0.88 0.322 1.119 0.29 ...</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 1 1 1 1 1 NA NA 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">#&gt;  $ series_2  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ score         : num [1:25] 2.01 NA 6.25 14.4 17.03 ...</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 1 NA 1 1 1 1 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">#&gt;  $ series_3  :'data.frame':  25 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ score         : num [1:25] 3.617 0.466 4.168 0.491 NA ...</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 0 1 0 1 NA 1 1 0 0 NA ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ score_type    : chr [1:25] "crps" "crps" "crps" "crps" ...</span></span>
<span><span class="co">#&gt;  $ all_series:'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ score       : num [1:25] 6.76 NA 10.74 16.01 NA ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon: int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ score_type  : chr [1:25] "sum_crps" "sum_crps" "sum_crps" "sum_crps" ...</span></span>
<span><span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span></span>
<span><span class="co">#&gt;         score in_interval interval_width eval_horizon score_type</span></span>
<span><span class="co">#&gt; 1   1.1362237           1            0.9            1       crps</span></span>
<span><span class="co">#&gt; 2   0.8796700           1            0.9            2       crps</span></span>
<span><span class="co">#&gt; 3   0.3222703           1            0.9            3       crps</span></span>
<span><span class="co">#&gt; 4   1.1191818           1            0.9            4       crps</span></span>
<span><span class="co">#&gt; 5   0.2902030           1            0.9            5       crps</span></span>
<span><span class="co">#&gt; 6          NA          NA            0.9            6       crps</span></span>
<span><span class="co">#&gt; 7          NA          NA            0.9            7       crps</span></span>
<span><span class="co">#&gt; 8   6.2283237           0            0.9            8       crps</span></span>
<span><span class="co">#&gt; 9   8.3822845           0            0.9            9       crps</span></span>
<span><span class="co">#&gt; 10  7.4587490           0            0.9           10       crps</span></span>
<span><span class="co">#&gt; 11 21.4860392           0            0.9           11       crps</span></span>
<span><span class="co">#&gt; 12 35.3964518           0            0.9           12       crps</span></span>
<span><span class="co">#&gt; 13 37.4077225           0            0.9           13       crps</span></span>
<span><span class="co">#&gt; 14 36.5122305           0            0.9           14       crps</span></span>
<span><span class="co">#&gt; 15 39.5236040           0            0.9           15       crps</span></span>
<span><span class="co">#&gt; 16 42.4870670           0            0.9           16       crps</span></span>
<span><span class="co">#&gt; 17 42.6519410           0            0.9           17       crps</span></span>
<span><span class="co">#&gt; 18 12.8012838           0            0.9           18       crps</span></span>
<span><span class="co">#&gt; 19 13.8279528           0            0.9           19       crps</span></span>
<span><span class="co">#&gt; 20  9.8057457           0            0.9           20       crps</span></span>
<span><span class="co">#&gt; 21  4.8109472           0            0.9           21       crps</span></span>
<span><span class="co">#&gt; 22  4.8450168           0            0.9           22       crps</span></span>
<span><span class="co">#&gt; 23  2.8327210           0            0.9           23       crps</span></span>
<span><span class="co">#&gt; 24  0.8850368           1            0.9           24       crps</span></span>
<span><span class="co">#&gt; 25  3.8071090           0            0.9           25       crps</span></span></code></pre></div>
<p>The returned list contains a <code>data.frame</code> for each series
in the data that shows the CRPS score for each evaluation in the testing
data, along with some other useful information about the fit of the
forecast distribution. In particular, we are given a logical value (1s
and 0s) telling us whether the true value was within a pre-specified
credible interval (i.e.Â the coverage of the forecast distribution). The
default interval width is 0.9, so we would hope that the values in the
<code>in_interval</code> column take a 1 approximately 90% of the time.
This value can be changed if you wish to compute different coverages,
say using a 60% interval:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">"crps"</span>, interval_width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span></span>
<span><span class="co">#&gt;         score in_interval interval_width eval_horizon score_type</span></span>
<span><span class="co">#&gt; 1   1.1362237           1            0.6            1       crps</span></span>
<span><span class="co">#&gt; 2   0.8796700           1            0.6            2       crps</span></span>
<span><span class="co">#&gt; 3   0.3222703           1            0.6            3       crps</span></span>
<span><span class="co">#&gt; 4   1.1191818           1            0.6            4       crps</span></span>
<span><span class="co">#&gt; 5   0.2902030           1            0.6            5       crps</span></span>
<span><span class="co">#&gt; 6          NA          NA            0.6            6       crps</span></span>
<span><span class="co">#&gt; 7          NA          NA            0.6            7       crps</span></span>
<span><span class="co">#&gt; 8   6.2283237           0            0.6            8       crps</span></span>
<span><span class="co">#&gt; 9   8.3822845           0            0.6            9       crps</span></span>
<span><span class="co">#&gt; 10  7.4587490           0            0.6           10       crps</span></span>
<span><span class="co">#&gt; 11 21.4860392           0            0.6           11       crps</span></span>
<span><span class="co">#&gt; 12 35.3964518           0            0.6           12       crps</span></span>
<span><span class="co">#&gt; 13 37.4077225           0            0.6           13       crps</span></span>
<span><span class="co">#&gt; 14 36.5122305           0            0.6           14       crps</span></span>
<span><span class="co">#&gt; 15 39.5236040           0            0.6           15       crps</span></span>
<span><span class="co">#&gt; 16 42.4870670           0            0.6           16       crps</span></span>
<span><span class="co">#&gt; 17 42.6519410           0            0.6           17       crps</span></span>
<span><span class="co">#&gt; 18 12.8012838           0            0.6           18       crps</span></span>
<span><span class="co">#&gt; 19 13.8279528           0            0.6           19       crps</span></span>
<span><span class="co">#&gt; 20  9.8057457           0            0.6           20       crps</span></span>
<span><span class="co">#&gt; 21  4.8109472           0            0.6           21       crps</span></span>
<span><span class="co">#&gt; 22  4.8450168           0            0.6           22       crps</span></span>
<span><span class="co">#&gt; 23  2.8327210           0            0.6           23       crps</span></span>
<span><span class="co">#&gt; 24  0.8850368           0            0.6           24       crps</span></span>
<span><span class="co">#&gt; 25  3.8071090           0            0.6           25       crps</span></span></code></pre></div>
<p>We can also compare forecasts against out of sample observations
using the <a href="https://link.springer.com/article/10.1007/s11222-016-9696-4" target="_blank" class="external-link">Expected Log Predictive Density (ELPD; also known as the
log score)</a>. The ELPD is a strictly proper scoring rule that can be
applied to any distributional forecast, but to compute it we need
predictions on the link scale rather than on the outcome scale. This is
where it is advantageous to change the type of prediction we can get
using the <code><a href="../reference/forecast.mvgam.html">forecast()</a></code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">link_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.mvgam.html">forecast</a></span><span class="op">(</span><span class="va">mod1</span>, newdata <span class="op">=</span> <span class="va">simdat</span><span class="op">$</span><span class="va">data_test</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">link_mod1</span>, score <span class="op">=</span> <span class="st">"elpd"</span><span class="op">)</span><span class="op">$</span><span class="va">series_1</span></span>
<span><span class="co">#&gt;         score eval_horizon score_type</span></span>
<span><span class="co">#&gt; 1   -2.232486            1       elpd</span></span>
<span><span class="co">#&gt; 2   -2.021430            2       elpd</span></span>
<span><span class="co">#&gt; 3   -1.249183            3       elpd</span></span>
<span><span class="co">#&gt; 4   -2.266812            4       elpd</span></span>
<span><span class="co">#&gt; 5   -1.252127            5       elpd</span></span>
<span><span class="co">#&gt; 6          NA            6       elpd</span></span>
<span><span class="co">#&gt; 7          NA            7       elpd</span></span>
<span><span class="co">#&gt; 8   -7.733385            8       elpd</span></span>
<span><span class="co">#&gt; 9   -9.085766            9       elpd</span></span>
<span><span class="co">#&gt; 10  -8.671512           10       elpd</span></span>
<span><span class="co">#&gt; 11 -21.237948           11       elpd</span></span>
<span><span class="co">#&gt; 12 -35.248924           12       elpd</span></span>
<span><span class="co">#&gt; 13 -34.666270           13       elpd</span></span>
<span><span class="co">#&gt; 14 -35.566371           14       elpd</span></span>
<span><span class="co">#&gt; 15 -38.164107           15       elpd</span></span>
<span><span class="co">#&gt; 16 -37.377479           16       elpd</span></span>
<span><span class="co">#&gt; 17 -46.300607           17       elpd</span></span>
<span><span class="co">#&gt; 18 -13.527263           18       elpd</span></span>
<span><span class="co">#&gt; 19 -14.289913           19       elpd</span></span>
<span><span class="co">#&gt; 20  -9.302897           20       elpd</span></span>
<span><span class="co">#&gt; 21  -7.084533           21       elpd</span></span>
<span><span class="co">#&gt; 22  -7.179676           22       elpd</span></span>
<span><span class="co">#&gt; 23  -5.787679           23       elpd</span></span>
<span><span class="co">#&gt; 24  -3.175058           24       elpd</span></span>
<span><span class="co">#&gt; 25  -6.243910           25       elpd</span></span></code></pre></div>
<p>Finally, when we have multiple time series it may also make sense to
use a multivariate proper scoring rule. <code>mvgam</code> offers two
such options: the Energy score and the Variogram score. The first
penalizes forecast distributions that are less well calibrated against
the truth, while the second penalizes forecasts that do not capture the
observed true correlation structure. Which score to use depends on your
goals, but both are very easy to compute:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">energy_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod2</span>, score <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">energy_mod2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ series_1  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 1 1 1 1 1 NA NA 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ series_2  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 1 NA 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ series_3  :'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ in_interval   : num [1:25] 1 1 1 1 NA 1 1 1 1 NA ...</span></span>
<span><span class="co">#&gt;   ..$ interval_width: num [1:25] 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 0.9 ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon  : int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ all_series:'data.frame':  25 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ score       : num [1:25] 4.75 NA 4.99 5.33 NA ...</span></span>
<span><span class="co">#&gt;   ..$ eval_horizon: int [1:25] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ score_type  : chr [1:25] "energy" "energy" "energy" "energy" ...</span></span></code></pre></div>
<p>The returned object still provides information on interval coverage
for each individual series, but there is only a single score per horizon
now (which is provided in the <code>all_series</code> slot):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">energy_mod2</span><span class="op">$</span><span class="va">all_series</span></span>
<span><span class="co">#&gt;        score eval_horizon score_type</span></span>
<span><span class="co">#&gt; 1   4.754920            1     energy</span></span>
<span><span class="co">#&gt; 2         NA            2     energy</span></span>
<span><span class="co">#&gt; 3   4.989503            3     energy</span></span>
<span><span class="co">#&gt; 4   5.326173            4     energy</span></span>
<span><span class="co">#&gt; 5         NA            5     energy</span></span>
<span><span class="co">#&gt; 6         NA            6     energy</span></span>
<span><span class="co">#&gt; 7         NA            7     energy</span></span>
<span><span class="co">#&gt; 8   3.900958            8     energy</span></span>
<span><span class="co">#&gt; 9   4.043380            9     energy</span></span>
<span><span class="co">#&gt; 10        NA           10     energy</span></span>
<span><span class="co">#&gt; 11 12.842520           11     energy</span></span>
<span><span class="co">#&gt; 12 22.035085           12     energy</span></span>
<span><span class="co">#&gt; 13        NA           13     energy</span></span>
<span><span class="co">#&gt; 14 20.567052           14     energy</span></span>
<span><span class="co">#&gt; 15 23.911131           15     energy</span></span>
<span><span class="co">#&gt; 16 24.922317           16     energy</span></span>
<span><span class="co">#&gt; 17 28.014677           17     energy</span></span>
<span><span class="co">#&gt; 18  6.071522           18     energy</span></span>
<span><span class="co">#&gt; 19 10.428866           19     energy</span></span>
<span><span class="co">#&gt; 20  4.043061           20     energy</span></span>
<span><span class="co">#&gt; 21  3.084471           21     energy</span></span>
<span><span class="co">#&gt; 22  3.457620           22     energy</span></span>
<span><span class="co">#&gt; 23        NA           23     energy</span></span>
<span><span class="co">#&gt; 24  9.183656           24     energy</span></span>
<span><span class="co">#&gt; 25  7.921793           25     energy</span></span></code></pre></div>
<p>You can use your score(s) of choice to compare different models. For
example, we can compute and plot the difference in CRPS scores for each
series in data. Here, a negative value means the AR(1) model
(<code>mod2</code>) is better, while a positive value means the spline
model (<code>mod1</code>) is better.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crps_mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod1</span>, score <span class="op">=</span> <span class="st">"crps"</span><span class="op">)</span></span>
<span><span class="va">crps_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.mvgam_forecast.html">score</a></span><span class="op">(</span><span class="va">fc_mod2</span>, score <span class="op">=</span> <span class="st">"crps"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_1</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_1</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Forecast horizon"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">AR1</span><span class="op">]</span> <span class="op">~</span> <span class="op">-</span><span class="op">~</span> <span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ar1_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"AR(1) better in "</span>,</span>
<span>  <span class="va">ar1_better</span>,</span>
<span>  <span class="st">" of "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>,</span>
<span>  <span class="st">" evaluations"</span>,</span>
<span>  <span class="st">"\nMean difference = "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-28-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_2</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_2</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Forecast horizon"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">AR1</span><span class="op">]</span> <span class="op">~</span> <span class="op">-</span><span class="op">~</span> <span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ar1_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"AR(1) better in "</span>,</span>
<span>  <span class="va">ar1_better</span>,</span>
<span>  <span class="st">" of "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>,</span>
<span>  <span class="st">" evaluations"</span>,</span>
<span>  <span class="st">"\nMean difference = "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-28-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">diff_scores</span> <span class="op">&lt;-</span> <span class="va">crps_mod2</span><span class="op">$</span><span class="va">series_3</span><span class="op">$</span><span class="va">score</span> <span class="op">-</span></span>
<span>  <span class="va">crps_mod1</span><span class="op">$</span><span class="va">series_3</span><span class="op">$</span><span class="va">score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diff_scores</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.25</span>, col <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Forecast horizon"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">[</span><span class="va">AR1</span><span class="op">]</span> <span class="op">~</span> <span class="op">-</span><span class="op">~</span> <span class="va">CRPS</span><span class="op">[</span><span class="va">spline</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ar1_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">diff_scores</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"AR(1) better in "</span>,</span>
<span>  <span class="va">ar1_better</span>,</span>
<span>  <span class="st">" of "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">diff_scores</span><span class="op">)</span>,</span>
<span>  <span class="st">" evaluations"</span>,</span>
<span>  <span class="st">"\nMean difference = "</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_scores</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="forecast_evaluation_files/figure-html/unnamed-chunk-28-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>The correlated AR(1) model consistently gives better forecasts, and
the difference between scores tends to grow as the forecast horizon
increases. This is not unexpected given the way that splines linearly
extrapolate outside the range of training data</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>The following papers and resources offer useful material about
Bayesian forecasting and proper scoring rules:</p>
<p>Clark N.J., et al.Â <a href="https://peerj.com/articles/18929/" class="external-link">Beyond
single-species models: leveraging multispecies forecasts to navigate the
dynamics of ecological predictability</a>. <em>PeerJ</em> 13:e18929
(2025) <a href="https://doi.org/10.7717/peerj.18929" class="external-link uri">https://doi.org/10.7717/peerj.18929</a></p>
<p>Hyndman, Rob J., and George Athanasopoulos. <a href="https://otexts.com/fpp3/distaccuracy.html" class="external-link">Forecasting: principles
and practice</a>. <em>OTexts</em>, (2018).</p>
<p>Gneiting, Tilmann, and Adrian E. Raftery. <a href="https://www.tandfonline.com/doi/abs/10.1198/016214506000001437" class="external-link">Strictly
proper scoring rules, prediction, and estimation</a> <em>Journal of the
American statistical Association</em> 102.477 (2007) 359-378.</p>
<p>Simonis, Juniper L., et al.Â <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.3431" class="external-link">Evaluating
probabilistic ecological forecasts</a> <em>Ecology</em> 102.8 (2021)
e03431.</p>
</div>
<div class="section level2">
<h2 id="interested-in-contributing">Interested in contributing?<a class="anchor" aria-label="anchor" href="#interested-in-contributing"></a>
</h2>
<p>Iâ€™m actively seeking PhD students and other researchers to work in
the areas of ecological forecasting, multivariate model evaluation and
development of <code>mvgam</code>. Please see <a href="https://ecogambler.netlify.app/opportunities/" class="external-link">this small list of
opportunities on my website</a> and do reach out if you are interested
(n.clarkâ€™atâ€™uq.edu.au)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://researchers.uq.edu.au/researcher/15140" class="external-link">Nicholas J Clark</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
